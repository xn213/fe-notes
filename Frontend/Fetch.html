<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | 余生的前端笔记本</title>
    <meta name="description" content="记录着很多很正常很平凡的代码">
    <link rel="shortcut icon" href="favicon.ico">
    
    <link rel="preload" href="/fe-notes/assets/css/0.styles.4425b58b.css" as="style"><link rel="preload" href="/fe-notes/assets/js/app.a315cfb5.js" as="script"><link rel="preload" href="/fe-notes/assets/js/23.2b5c528b.js" as="script"><link rel="prefetch" href="/fe-notes/assets/js/10.fb928311.js"><link rel="prefetch" href="/fe-notes/assets/js/11.aadaf7d9.js"><link rel="prefetch" href="/fe-notes/assets/js/12.c2a5044d.js"><link rel="prefetch" href="/fe-notes/assets/js/13.83caf465.js"><link rel="prefetch" href="/fe-notes/assets/js/14.ffcf277d.js"><link rel="prefetch" href="/fe-notes/assets/js/15.221d7ea1.js"><link rel="prefetch" href="/fe-notes/assets/js/16.2117d375.js"><link rel="prefetch" href="/fe-notes/assets/js/17.3c337b01.js"><link rel="prefetch" href="/fe-notes/assets/js/18.c1ae868f.js"><link rel="prefetch" href="/fe-notes/assets/js/19.e565064b.js"><link rel="prefetch" href="/fe-notes/assets/js/2.28e58bf3.js"><link rel="prefetch" href="/fe-notes/assets/js/20.aa98cc4b.js"><link rel="prefetch" href="/fe-notes/assets/js/21.965a6f1c.js"><link rel="prefetch" href="/fe-notes/assets/js/22.1e62d5e3.js"><link rel="prefetch" href="/fe-notes/assets/js/24.0dcb5f09.js"><link rel="prefetch" href="/fe-notes/assets/js/25.ed24afee.js"><link rel="prefetch" href="/fe-notes/assets/js/26.df2844ae.js"><link rel="prefetch" href="/fe-notes/assets/js/27.bdb6ae41.js"><link rel="prefetch" href="/fe-notes/assets/js/28.39e0481f.js"><link rel="prefetch" href="/fe-notes/assets/js/29.ea964833.js"><link rel="prefetch" href="/fe-notes/assets/js/3.b03056ff.js"><link rel="prefetch" href="/fe-notes/assets/js/30.ec1c75e6.js"><link rel="prefetch" href="/fe-notes/assets/js/31.526532f9.js"><link rel="prefetch" href="/fe-notes/assets/js/32.c33011bd.js"><link rel="prefetch" href="/fe-notes/assets/js/33.e4d4d3e4.js"><link rel="prefetch" href="/fe-notes/assets/js/34.0ce26e85.js"><link rel="prefetch" href="/fe-notes/assets/js/35.5a4fad8a.js"><link rel="prefetch" href="/fe-notes/assets/js/36.1595be48.js"><link rel="prefetch" href="/fe-notes/assets/js/37.e0ce17c3.js"><link rel="prefetch" href="/fe-notes/assets/js/38.640ebbce.js"><link rel="prefetch" href="/fe-notes/assets/js/39.ddadeb4f.js"><link rel="prefetch" href="/fe-notes/assets/js/4.82ea8550.js"><link rel="prefetch" href="/fe-notes/assets/js/40.3f70ec6a.js"><link rel="prefetch" href="/fe-notes/assets/js/41.c168973e.js"><link rel="prefetch" href="/fe-notes/assets/js/42.20197fb1.js"><link rel="prefetch" href="/fe-notes/assets/js/43.477a58bd.js"><link rel="prefetch" href="/fe-notes/assets/js/44.447ee589.js"><link rel="prefetch" href="/fe-notes/assets/js/45.658fe318.js"><link rel="prefetch" href="/fe-notes/assets/js/46.089c988d.js"><link rel="prefetch" href="/fe-notes/assets/js/47.f508b246.js"><link rel="prefetch" href="/fe-notes/assets/js/48.7dc7c3ad.js"><link rel="prefetch" href="/fe-notes/assets/js/49.0d6ba307.js"><link rel="prefetch" href="/fe-notes/assets/js/5.8000d0fb.js"><link rel="prefetch" href="/fe-notes/assets/js/50.75b49f6e.js"><link rel="prefetch" href="/fe-notes/assets/js/51.dfb8c173.js"><link rel="prefetch" href="/fe-notes/assets/js/52.721163ea.js"><link rel="prefetch" href="/fe-notes/assets/js/53.2a0be6ab.js"><link rel="prefetch" href="/fe-notes/assets/js/54.1b1d5c10.js"><link rel="prefetch" href="/fe-notes/assets/js/55.a99bd7ac.js"><link rel="prefetch" href="/fe-notes/assets/js/56.f52cb796.js"><link rel="prefetch" href="/fe-notes/assets/js/57.573d120d.js"><link rel="prefetch" href="/fe-notes/assets/js/58.45fa381c.js"><link rel="prefetch" href="/fe-notes/assets/js/59.49ee2f42.js"><link rel="prefetch" href="/fe-notes/assets/js/6.0d738f92.js"><link rel="prefetch" href="/fe-notes/assets/js/60.0b90961e.js"><link rel="prefetch" href="/fe-notes/assets/js/61.253d77e2.js"><link rel="prefetch" href="/fe-notes/assets/js/62.c07675c5.js"><link rel="prefetch" href="/fe-notes/assets/js/63.f019a42f.js"><link rel="prefetch" href="/fe-notes/assets/js/64.4faa1e06.js"><link rel="prefetch" href="/fe-notes/assets/js/65.49ad871b.js"><link rel="prefetch" href="/fe-notes/assets/js/66.a8b893a2.js"><link rel="prefetch" href="/fe-notes/assets/js/67.ff15d1ad.js"><link rel="prefetch" href="/fe-notes/assets/js/68.0c74815b.js"><link rel="prefetch" href="/fe-notes/assets/js/69.3829413b.js"><link rel="prefetch" href="/fe-notes/assets/js/7.52af0d3a.js"><link rel="prefetch" href="/fe-notes/assets/js/70.34779f17.js"><link rel="prefetch" href="/fe-notes/assets/js/71.0f2f8855.js"><link rel="prefetch" href="/fe-notes/assets/js/72.c93416e6.js"><link rel="prefetch" href="/fe-notes/assets/js/73.2aa63098.js"><link rel="prefetch" href="/fe-notes/assets/js/74.ed3430df.js"><link rel="prefetch" href="/fe-notes/assets/js/75.76d572c4.js"><link rel="prefetch" href="/fe-notes/assets/js/76.2b62e0fd.js"><link rel="prefetch" href="/fe-notes/assets/js/77.4ba23c48.js"><link rel="prefetch" href="/fe-notes/assets/js/78.e51bf096.js"><link rel="prefetch" href="/fe-notes/assets/js/79.89f9cab4.js"><link rel="prefetch" href="/fe-notes/assets/js/8.452fddde.js"><link rel="prefetch" href="/fe-notes/assets/js/80.8d53b12f.js"><link rel="prefetch" href="/fe-notes/assets/js/81.b6ba5f90.js"><link rel="prefetch" href="/fe-notes/assets/js/82.e6f90536.js"><link rel="prefetch" href="/fe-notes/assets/js/83.51689d6c.js"><link rel="prefetch" href="/fe-notes/assets/js/84.0d91a7c0.js"><link rel="prefetch" href="/fe-notes/assets/js/9.183d73fe.js">
    <link rel="stylesheet" href="/fe-notes/assets/css/0.styles.4425b58b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-notes/" class="home-link router-link-active"><!----> <span class="site-name">余生的前端笔记本</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-notes/Frontend/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><a href="/fe-notes/notes/" class="nav-link">笔记本</a></div><div class="nav-item"><a href="/fe-notes/Vue/VueBasic/VueRespond.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/fe-notes/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/fe-notes/CodeTools/VSCode/VSCodeVue.html" class="nav-link">code工具</a></div><div class="nav-item"><a href="/fe-notes/dzh/Explain.html" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="https://xn213.github.io/FrontEndNav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  余生博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-notes/Frontend/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><a href="/fe-notes/notes/" class="nav-link">笔记本</a></div><div class="nav-item"><a href="/fe-notes/Vue/VueBasic/VueRespond.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/fe-notes/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/fe-notes/CodeTools/VSCode/VSCodeVue.html" class="nav-link">code工具</a></div><div class="nav-item"><a href="/fe-notes/dzh/Explain.html" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="https://xn213.github.io/FrontEndNav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  余生博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fe-notes/Frontend/Fetch.html" class="active sidebar-link">Fetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#fetch-简介" class="sidebar-link">Fetch 简介</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#fetch-基本概念" class="sidebar-link">Fetch 基本概念</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#fetch-与-xhr-比较" class="sidebar-link">Fetch 与 XHR 比较</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#如何使用fetch" class="sidebar-link">如何使用Fetch</a></li><li class="sidebar-sub-header"><a href="/fe-notes/Frontend/Fetch.html#总结" class="sidebar-link">总结</a></li></ul></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Code Style</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>本篇主要讲述 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的一些基本知识点以及我们在生产开发中怎么去使用。为了能够更好的了解 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我们希望你对以下知识点有所了解，如果有相关的开发经验，那是最好不过的了。</p> <ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <p>本文中对有些关键词提供了相应的链接，如果你对该关键词不够了解或想要了解更多，你可以通过点击它充实自己。文中有些知识点在  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">MDN Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上已经写的很详细，因此有略过，希望同学们在阅读本文章时能够同时对照阅读。</p> <p>本文行文思路首先从<a href="https://fetch.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>入手，目的是让大家了解的更透彻，达到知其然知其所以然。</p> <p>为了更好的掌握 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，文章中还提供了一些<a href="https://github.com/GoDotDotDot/fe9-fetch-demo/" target="_blank" rel="noopener noreferrer">示例代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>供大家学习使用。在使用该示例代码前，我们希望你对 <a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">node.js <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 有一些了解，如果没有的话，你可以根据示例中的友情提示完成你的这次学习体验。</p> <p>读完本篇文章后你将了解到以下内容：</p> <ul><li><p>什么是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的一些基本概念</p></li> <li><p>如何使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的一些不足以及我们如何“优雅”的使用它</p></li></ul> <p>希望你通过读完本篇文章后，对 Fetch 有一个基本的了解。</p> <h2 id="fetch-简介"><a href="#fetch-简介" aria-hidden="true" class="header-anchor">#</a> Fetch 简介</h2> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一种新的用于获取资源的技术，它被用来代替我们已经吐槽了很久的技术（<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用起来很简单，它返回的是一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，即使你没有 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的开发经验也能快速上手。说了那么多，我们还是先睹为快吧，让我们快快下面的示例代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://github.com/frontend9/fe9-library'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
method<span class="token punctuation">:</span> <span class="token string">'get'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// Error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>是不是简单的不能再简单了？好，既然我们 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 有了简单的认识之后，那我们再来了解下 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的基本概念。</p> <h2 id="fetch-基本概念"><a href="#fetch-基本概念" aria-hidden="true" class="header-anchor">#</a> Fetch 基本概念</h2> <p>在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中有四个基本概念，他们分别是 <strong>Headers</strong>、<strong>Request</strong> 、<strong>Response</strong> 和 <strong>Body</strong>。为了更好的理解 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我们需要对这些概念做一个简单的了解。</p> <p>在一个完整的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 请求中，其实就已经包含了这四个概念。请求中有请求头和请求体，响应中有响应头和响应体。所以我们有必要了解这些概念。</p> <h3 id="headers"><a href="#headers" aria-hidden="true" class="header-anchor">#</a> Headers</h3> <p>为了实现头部的灵活性，能够对头部进行修改是一个非常重要的能力。Headers 属于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers" target="_blank" rel="noopener noreferrer">首部<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的一份子，它是一个抽象的接口，利用它可以对 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的请求头和响应头做出添加、修改和删除的操作。</p> <p>下面我们先看一下它具有哪些接口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">typedef</span> <span class="token punctuation">(</span>sequence<span class="token operator">&lt;</span>sequence<span class="token operator">&lt;</span>ByteString<span class="token operator">&gt;&gt;</span>or record<span class="token operator">&lt;</span>ByteString<span class="token punctuation">,</span> ByteString<span class="token operator">&gt;</span><span class="token punctuation">)</span> HeadersInit<span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token function">Constructor</span><span class="token punctuation">(</span>optional HeadersInit init<span class="token punctuation">)</span><span class="token punctuation">,</span>
Exposed<span class="token operator">=</span><span class="token punctuation">(</span>Window<span class="token punctuation">,</span>Worker<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">interface</span> <span class="token class-name">Headers</span> <span class="token punctuation">{</span>
<span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">,</span> ByteString value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
ByteString<span class="token operator">?</span> <span class="token keyword">get</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
boolean <span class="token function">has</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token keyword">set</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">,</span> ByteString value<span class="token punctuation">)</span><span class="token punctuation">;</span>
iterable<span class="token operator">&lt;</span>ByteString<span class="token punctuation">,</span> ByteString<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">interface</span> <span class="token class-name">Headers</span> <span class="token punctuation">{</span>
<span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">,</span> ByteString value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
ByteString<span class="token operator">?</span> <span class="token keyword">get</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
boolean <span class="token function">has</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token keyword">set</span><span class="token punctuation">(</span>ByteString name<span class="token punctuation">,</span> ByteString value<span class="token punctuation">)</span><span class="token punctuation">;</span>
iterable<span class="token operator">&lt;</span>ByteString<span class="token punctuation">,</span> ByteString<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 来自 https://fetch.spec.whatwg.org/#headers-class</span>
</code></pre></div><p>规范中定义的接口我们可以对应着 <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行查看，你可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers#%E6%96%B9%E6%B3%95" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更直观的看看看看它有哪些方法供我们使用。</p> <p>这里我们对 <code>Headers</code> 的构造参数做个解释。首先参数类型为 <code>HeadersInit</code>，我们再看下这个类型支持哪些类型的值。我们从规范中可以看到的定义是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">typedef</span> <span class="token punctuation">(</span>sequence<span class="token operator">&lt;</span>sequence<span class="token operator">&lt;</span>ByteString<span class="token operator">&gt;&gt;</span> or record<span class="token operator">&lt;</span>ByteString<span class="token punctuation">,</span> ByteString<span class="token operator">&gt;</span><span class="token punctuation">)</span> HeadersInit<span class="token punctuation">;</span>
</code></pre></div><p>这里我们对应到 <code>JavaScript</code> 这门语言，意思就是说这个对象可以是数组或者是键值对（即对象）。关于如何初始化这些参数，我们可以看下规范中定义的<a href="https://fetch.spec.whatwg.org/#concept-headers-fill" target="_blank" rel="noopener noreferrer">流程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <blockquote><p>To fill a <code>Headers</code> object (headers) with a given object (object), run these steps:</p> <ol><li><p>If object is a <a href="https://heycam.github.io/webidl/#idl-sequence" target="_blank" rel="noopener noreferrer">sequence<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, then <a href="https://infra.spec.whatwg.org/#list-iterate" target="_blank" rel="noopener noreferrer">for each<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> header in object:</p></li> <li><ol><li>If header does not contain exactly two items, then <a href="https://heycam.github.io/webidl/#dfn-throw" target="_blank" rel="noopener noreferrer">throw<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> a <code>TypeError</code>.</li></ol></li> <li><ol start="2"><li><a href="https://fetch.spec.whatwg.org/#concept-headers-append" target="_blank" rel="noopener noreferrer">Append<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> header’s first item/header’s second item to headers.</li></ol></li> <li><p>Otherwise, object is a <a href="https://heycam.github.io/webidl/#idl-record" target="_blank" rel="noopener noreferrer">record<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, then <a href="https://infra.spec.whatwg.org/#map-iterate" target="_blank" rel="noopener noreferrer">for each<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> key → value in object, <a href="https://fetch.spec.whatwg.org/#concept-headers-append" target="_blank" rel="noopener noreferrer">append<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> key/value to headers.</p></li></ol></blockquote> <p>这里我需要对这个做个说明，后面对 fetch 的用法会涉及到一点以及我们看 <a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 都会有所帮助。</p> <ul><li><p>第一种：即数组，当数据每项如果不包含两项时，直接抛出错误。然后数组第一项是 <code>header</code> 名，第二项是值。，最后直接通过 <code>append</code> 方法添加。</p></li> <li><p>第二种：即键值对（这里指对象），我们通过循环直接取到键值对，然后通过 <code>append</code> 方法添加。</p></li></ul> <h4 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h4> <p>示例代码地址：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/views/headers.html#L17</p> <p>打开浏览器输入：http://127.0.0.1:4000/headers</p> <p>那么我们该如何使用它呢？首先我们需要通过 <code>new Headers()</code> 来实例化一个 Headers 对象，该对象返回的是一个空的列表。在有了对象实例后，我们就可以通过接口来完成我们想要的操作，我们来一起看看下面的示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">functionprintHeaders</span><span class="token punctuation">(</span><span class="token parameter">headers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> str<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> header <span class="token keyword">of</span> headers<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
str <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`
&lt;li&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>header<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>header<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
`</span></span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>header<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> header<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;ul&gt;
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
&lt;/ul&gt;`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 我们打印下看看是否返回的是一个空的列表</span>
<span class="token keyword">const</span> before <span class="token operator">=</span> <span class="token function">printHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发现这里没有任何输出</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'headers-before'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> before<span class="token punctuation">;</span>
<span class="token comment">// 我们添加一个请求头</span>
headers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> headers2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
<span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'abcdefg'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> after <span class="token operator">=</span> <span class="token function">printHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：content-type:</span>
</code></pre></div><p>如果你觉得每次都要 <code>append</code> 麻烦的话，你也可以通过在构造函数中传入指定的头部，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>constheaders2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
<span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'abcdefg'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printHeaders</span><span class="token punctuation">(</span>headers2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// content-type: text/plain</span>
<span class="token comment">// x-token: abcdefg</span>
</code></pre></div><p>这里我添加了一个自定义头部 <code>X-Token</code>，这在实际开发中很常见也很有实际意义。但是切记在 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中需要满足相关规范，否则会产生跨域错误。</p> <p>你可以通过<code>append</code> 、 <code>delete</code> 、<code>set</code> 、<code>get</code> 和<code>has</code> 方法修改请求头。这里对 <code>set</code> 和 <code>append</code> 方法做个特殊的说明：</p> <p><code>set</code>： 如果对一个已经存在的头部进行操作的话，会将新值替换掉旧值，旧值将不会存在。如果头部不存在则直接添加这个新的头部。</p> <p><code>append</code>：如果已经存在该头部，则直接将新值追加到后面，还会保留旧值。</p> <p>为了方便记忆，你只需要记住 <code>set</code> 会覆盖，而 <code>append</code> 会追加。</p> <h4 id="guard"><a href="#guard" aria-hidden="true" class="header-anchor">#</a> Guard</h4> <p>Guard 是 Headers 的一个特性，他是一个守卫者。它影响着一些方法（像 <code>append</code> 、 <code>set</code> 、<code>delete</code>）是否可以改变 header 头。</p> <p>它可以有以下取值：<code>immutable</code>、<code>request</code>、<code>request-no-cors</code>、<code>response</code> 或 <code>none</code>。</p> <p>这里你无需关心它，只是为你让你了解有这样个东西在影响着我们设置一些 Headers。你也无法去操作它，这是代理的事情。举个简单的例子，我们无法在 Response Headers 中插入一个 <code>Set-Cookie</code>。</p> <p>如果你想要了解更过的细节，具体的规范请参考 <a href="https://fetch.spec.whatwg.org/#concept-headers-guard" target="_blank" rel="noopener noreferrer">concept-headers-guard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Basic_concepts#Guard" target="_blank" rel="noopener noreferrer">MDN Guard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="注意"><a href="#注意" aria-hidden="true" class="header-anchor">#</a> 注意</h3> <ul><li>我们在给头部赋值的时候需要满足<a href="https://fetch.spec.whatwg.org/#concept-header-name" target="_blank" rel="noopener noreferrer">可接受的首部字段集合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>否则将会报 <code>TypeError</code> 。</li></ul> <h3 id="body"><a href="#body" aria-hidden="true" class="header-anchor">#</a> Body</h3> <p>Body 准确来说这里只是 <a href="https://developer.mozilla.org/en-US/docs/Glossary/mixin" target="_blank" rel="noopener noreferrer">mixin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，代表着请求体或响应体，具体由 <code>Response</code> 和 <code>Request</code> 来实现。</p> <p>下面我们来看看它具有哪些接口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">mixinBody</span> <span class="token punctuation">{</span>
readonly attribute ReadableStream<span class="token operator">?</span> body<span class="token punctuation">;</span>
readonly attribute boolean bodyUsed<span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span> <span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span> <span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>FormData<span class="token operator">&gt;</span> <span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>USVString<span class="token operator">&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 来自 https://fetch.spec.whatwg.org/#body</span>
</code></pre></div><p>规范中定义的接口我们可以对应着 <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行查看，你可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Body" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更直观的看看它有哪些属性和方法供我们使用。</p> <p>这里需要注意看这些方法返回的都是 <code>Promise</code>，记住这在基于 <code>fetch</code> 进行接口请求中很重要。记住了这个，有利于我们在后面的文章中理解 <code>fetch</code> 的用法。</p> <h4 id="范例"><a href="#范例" aria-hidden="true" class="header-anchor">#</a> 范例</h4> <p>范例将在 <code>Response</code> 中体现。</p> <h3 id="request"><a href="#request" aria-hidden="true" class="header-anchor">#</a> Request</h3> <p>Request 表示一个请求类，需要通过实例化来生成一个请求对象。通过该对象可以描述一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 请求中的请求（一般含有请求头和请求体）。既然是用来描述请求对象，那么该请求对象应该具有修改请求头（Headers）和请求体（Body）的方式。下面我们先来看下规范中 Request 具有哪些接口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">typedef</span> <span class="token punctuation">(</span>Request or USVString<span class="token punctuation">)</span> RequestInfo<span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token function">Constructor</span><span class="token punctuation">(</span>RequestInfo input<span class="token punctuation">,</span> optional RequestInitinit<span class="token punctuation">)</span><span class="token punctuation">,</span>
Exposed<span class="token operator">=</span><span class="token punctuation">(</span>Window<span class="token punctuation">,</span>Worker<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">interface</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span>
readonly attribute ByteString method<span class="token punctuation">;</span>
readonly attribute USVString url<span class="token punctuation">;</span>
<span class="token punctuation">[</span>SameObject<span class="token punctuation">]</span> readonly attribute Headers headers<span class="token punctuation">;</span>

readonly attribute RequestDestination destination<span class="token punctuation">;</span>
readonly attribute USVString referrer<span class="token punctuation">;</span>
readonly attribute ReferrerPolicy referrerPolicy<span class="token punctuation">;</span>
readonly attribute RequestMode mode<span class="token punctuation">;</span>
readonly attribute RequestCredentials credentials<span class="token punctuation">;</span>
readonly attribute RequestCache cache<span class="token punctuation">;</span>
readonly attribute RequestRedirect redirect<span class="token punctuation">;</span>
readonly attribute DOMString integrity<span class="token punctuation">;</span>
readonly attribute boolean keepalive<span class="token punctuation">;</span>
readonly attribute boolean isReloadNavigation<span class="token punctuation">;</span>
readonly attribute boolean isHistoryNavigation<span class="token punctuation">;</span>
readonly attribute AbortSignal signal<span class="token punctuation">;</span>

<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Request <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Request includes Body<span class="token punctuation">;</span>

dictionary RequestInit <span class="token punctuation">{</span>
ByteString method<span class="token punctuation">;</span>
HeadersInit headers<span class="token punctuation">;</span>
BodyInit<span class="token operator">?</span> body<span class="token punctuation">;</span>
USVString referrer<span class="token punctuation">;</span>
ReferrerPolicy referrerPolicy<span class="token punctuation">;</span>
RequestMode mode<span class="token punctuation">;</span>
RequestCredentials credentials<span class="token punctuation">;</span>
RequestCache cache<span class="token punctuation">;</span>
RequestRedirect redirect<span class="token punctuation">;</span>
DOMString integrity<span class="token punctuation">;</span>
boolean keepalive<span class="token punctuation">;</span>
AbortSignal<span class="token operator">?</span> signal<span class="token punctuation">;</span>
any window<span class="token punctuation">;</span> <span class="token comment">// can only be set to null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> RequestDestination <span class="token punctuation">{</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;audio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;audioworklet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;document&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;embed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manifest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;paintworklet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;script&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sharedworker&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;track&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;video&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xslt&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> RequestMode <span class="token punctuation">{</span> <span class="token string">&quot;navigate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no-cors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cors&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> RequestCredentials <span class="token punctuation">{</span> <span class="token string">&quot;omit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;include&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> RequestCache <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no-store&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reload&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;force-cache&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;only-if-cached&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> RequestRedirect <span class="token punctuation">{</span> <span class="token string">&quot;follow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;manual&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 来自 https://fetch.spec.whatwg.org/#request-class</span>
</code></pre></div><p>规范中定义的接口我们可以对应着 <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行查看，你可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更直观的看看它有哪些属性和方法供我们使用，这里不做一一解释。</p> <p>注意这里的属性都是只读的，规范中我们可以看到构造函数的第一个参数为 <code>Request</code> 对象或字符串，我们一般采取字符串，即需要访问的资源地址（ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 接口地址）。第二个参数接收一个 <code>RequestInit</code> 可选对象，而这个对象是一个字典。在 <code>javascript</code> 中，我们可以理解为一个对象（{}）。<code>RequestInit</code> 里面我们可以配置初始属性，告诉 <code>Request</code> 我们这个请求的一些配置信息。</p> <p>这里我们需要对以下几个属性特别注意下。</p> <p><strong>mode</strong> 是一个 <code>RequestMode</code> 枚举类型，可取的值有 <code>navigate</code>, <code>same-origin</code>,  <code>no-cors</code>, <code>cors</code>。它表示的是一个请求时否使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，还是使用严格同源模式。当处于跨域情况下，你应当设置为 <code>cors</code>。该值的默认值在使用 <code>Request</code> 初始化时，默认为 <code>cors</code>。当使用标记启动的嵌入式资源，例如 <code>&lt;link&gt;</code>、 <code>&lt;script&gt;</code>标签（未手动修改 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_settings_attributes" target="_blank" rel="noopener noreferrer">crossorigin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 属性），默认为 <code>no-cors</code>。详细信息请参考 <a href="https://fetch.spec.whatwg.org/#concept-request-mode" target="_blank" rel="noopener noreferrer">whatwg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 规范或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request/mode" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <p><strong>credentials</strong> 是一个 <code>RequestCredentials</code> 枚举类型，可取的值有 <code>omit</code>, <code>same-origin</code>, <code>include</code>。它表示的是请求是否在跨域情况下发送 <code>cookie</code>。看到这，如果对 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 了解的同学应该很熟悉。这和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中的 <code>withCredentials</code> 很相似。但是 <code>credentials</code> 有三个可选值，它的默认值为 <code>same-origin</code>。当你需要跨域传递 <code>cookie</code> 凭证信息时，请设置它为 <code>include</code>。注意这里有一个细节，当设置为 <code>include</code> 时，请确保 <code>Response Header</code> 中 <code>Access-Control-Allow-Origin</code> 不能为 <code>*</code>，需要指定源（例如：<a href="http://127.0.0.1:4001/" target="_blank" rel="noopener noreferrer">http://127.0.0.1:4001<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），否则会你将会在控制台看到如下错误信息。详细信息请参考 <a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" target="_blank" rel="noopener noreferrer">whatwg<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 规范或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request/credentials" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <blockquote><p>The value of the 'Access-Control-Allow-Origin' header in the response must not be the wildcard '*' when the request's credentials mode is 'include'.</p></blockquote> <p><em>你可以使用文章中提供的代码中启动</em> <em><code>cors</code></em> __<a href="https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/cors.js" target="_blank" rel="noopener noreferrer">示例代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><em>，然后在浏览器中输入</em> <a href="http://127.0.0.1:4001/request%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%87%BA%E6%84%8F%E5%A4%96%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BD%A0%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E7%9C%8B%E5%88%B0%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA" target="_blank" rel="noopener noreferrer">http://127.0.0.1:4001/request，如果不出意外的话，你可以在控制台中看到上面的错误提示<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>body</strong> 是一个 <a href="https://fetch.spec.whatwg.org/#bodyinit" target="_blank" rel="noopener noreferrer">BodyInit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 类型。它可取的值有 <code>Blob</code>,<code>BufferSource</code> , <code>FormData</code> , <code>URLSearchParams</code> , <code>ReadableStream</code> , <code>USVString</code>。细心的同学不知道有没有发现，我们常见的 <code>json</code> 对象却不在其中。因此，我们如果需要传递 <code>json</code> 的话，需要调用 <code>JSON.stringify</code> 函数来帮助我们转换成字符串。</p> <p>下面将给出一段示例代码。</p> <h4 id="示例-2"><a href="#示例-2" aria-hidden="true" class="header-anchor">#</a> 示例</h4> <p>示例代码地址：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/views/request.html#L24</p> <p>打开浏览器输入：http://127.0.0.1:4000/request</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 客户端constheaders=new Headers({</span>
<span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'fe9'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/api/request'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
headers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Request {method: &quot;GET&quot;, url: &quot;http://127.0.0.1:4000/api/request&quot;, headers: Headers, destination: &quot;&quot;, referrer: &quot;about:client&quot;, …}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// GET</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cors</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>credentials<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// same-origin</span>
<span class="token comment">// 如果你想打印headers信息，可以调用 printHeaders(request.headers)</span>
</code></pre></div><p>这里我们先以 <code>GET</code> 简单请求作为示例，我们传递了一个自定义的 <code>Headers</code>，指定了请求方法 <code>method</code> 为 <code>GET</code>（默认为 <code>GET</code>）。在上面的接口规范中，我们可以通过 <code>Request</code> 对象拿到一些常用的属性，比如 <code>method</code>、<code>url</code>、<code>headers</code> 、<code>body</code> 等等只读属性。</p> <h3 id="response"><a href="#response" aria-hidden="true" class="header-anchor">#</a> Response</h3> <p>Response 和 Request 类似，表示的是一次请求返回的响应数据。下面我们先看下规范中定义了哪些接口。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token function">Constructor</span><span class="token punctuation">(</span>optional BodyInit<span class="token operator">?</span> body <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> optionalResponseInitinit<span class="token punctuation">)</span><span class="token punctuation">,</span> Exposed<span class="token operator">=</span><span class="token punctuation">(</span>Window<span class="token punctuation">,</span>Worker<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">interface</span> <span class="token class-name">Response</span> <span class="token punctuation">{</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> <span class="token keyword">static</span> Response <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> <span class="token keyword">static</span> Response <span class="token function">redirect</span><span class="token punctuation">(</span>USVString url<span class="token punctuation">,</span> optional unsigned short status <span class="token operator">=</span> <span class="token number">302</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readonly attribute ResponseType type<span class="token punctuation">;</span>

readonly attribute USVString url<span class="token punctuation">;</span>
readonly attribute boolean redirected<span class="token punctuation">;</span>
readonly attribute unsigned short status<span class="token punctuation">;</span>
readonly attribute boolean ok<span class="token punctuation">;</span>
readonly attribute ByteString statusText<span class="token punctuation">;</span>
<span class="token punctuation">[</span>SameObject<span class="token punctuation">]</span> readonly attribute Headers headers<span class="token punctuation">;</span>
readonly attribute Promise<span class="token operator">&lt;</span>Headers<span class="token operator">&gt;</span> trailer<span class="token punctuation">;</span>

<span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Response <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Response includes Body<span class="token punctuation">;</span>

dictionary ResponseInit <span class="token punctuation">{</span>
unsigned short status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
ByteString statusText <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
HeadersInit headers<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> ResponseType <span class="token punctuation">{</span> <span class="token string">&quot;basic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;opaque&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;opaqueredirect&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 来自 https://fetch.spec.whatwg.org/#response-class</span>
</code></pre></div><p>规范中定义的接口我们可以对应着 <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行查看，你可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Response" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更直观的看看它有哪些属性和方法供我们使用，这里不做一一解释。</p> <p>其中 <code>status</code>, <code>headers</code> 属性最为常用。通过 <code>status</code> 状态码我们可以判断出服务端请求处理的结果，像 <code>200</code>, <code>403</code> 等等常见状态码。这里举个例子，当 <code>status</code> 为 <code>401</code> 时，可以在前端进行拦截跳转到登录页面，这在现如今 <code>SPA</code>（单页面应用程序）中尤为常见。我们也可以利用 <code>headers</code> 来获取一些服务端返回给前端的信息，比如 <code>token</code>。</p> <p>仔细看上面的接口的同学可以发现 <code>Response includes Body;</code> 这样的标识。在前面我们说过 <code>Body</code> 由 <code>Request</code> 和 <code>Response</code> 实现。所以 <code>Body</code> 具有的方法，在 <code>Response</code> 实例中都可以使用，而这也是非常重要的一部分，我们通过 <code>Body</code>  提供的方法（这里准确来说是由 <code>Response</code> 实现的）对服务端返回的数据进行处理。</p> <p>下面我们将通过一个示例来了解下简单用法：</p> <h4 id="示例-3"><a href="#示例-3" aria-hidden="true" class="header-anchor">#</a> 示例</h4> <p>示例代码位置：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/views/response.html#L36</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 客户端constheaders= new Headers({</span>
<span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'fe9-token-from-frontend'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/api/response'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
headers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这里我们先发起一个请求试一试</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'status'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'headers'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">headersToString</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resData</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> resData<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'发生了一个错误！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里我们先忽略 <code>fetch</code> 用法，后面的章节中会进行详细介绍。我们先关注第一个 <code>then</code> 方法回调里面的东西。可以看到返回了一个 <code>response</code> 对象，这个对象就是我们的 <code>Response</code> 的实例。示例中拿了 <code>status</code> 和 <code>headers</code> ，为了方便，这里我将其放到 html 中。再看看该回调中最后一行，我们调用了一个 <code>response.json()</code> 方法（这里后端返的数据是一个 <code>JSON</code> 对象，为了方便直接调用 <code>json()</code>），该方法返回一个 <code>Promise</code>，我们将处理结果返给最后一个 <code>then</code> 回调，这样就可以获得最终处理过后的数据。</p> <p>打开浏览器，输入 http://127.0.0.1:4000/response，如果你的示例代运行正常，你将会看到以下页面：</p> <p><img src="https://cdn.nlark.com/yuque/0/2018/png/210399/1543758546072-840daa30-27cc-4f1f-8199-29a9876dc943.png" alt></p> <p>（查看 Response 返回的数据）</p> <h2 id="fetch-与-xhr-比较"><a href="#fetch-与-xhr-比较" aria-hidden="true" class="header-anchor">#</a> Fetch 与 XHR 比较</h2> <p>Fetch 相对 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来说具有简洁、易用、声明式、天生基于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 等特点。<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  使用方式复杂，接口繁多，最重要的一点个人觉得是它的回调设计，对于实现 <code>try...catch</code> 比较繁琐。</p> <p>但是 Fetch 也有它的不足，相对于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  来说，目前它具有以下劣势：</p> <ul><li><p>不能取消（虽然 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FetchController" target="_blank" rel="noopener noreferrer">AbortController<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 能实现，但是目前兼容性基本不能使用，可以使用 <a href="https://github.com/mo/abortcontroller-polyfill" target="_blank" rel="noopener noreferrer">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）</p></li> <li><p>不能获取进度</p></li> <li><p>不能设置超时（可以通过简单的封装来模拟实现）</p></li> <li><p>兼容性目前比较差（可以使用 <a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 间接使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来优雅降级，这里推荐使用 <a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="noopener noreferrer">isomorphic-fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）</p></li></ul> <p>在了解 Fetch 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer">XHR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的一些不同后，还是需要根据自身的业务需求来选择合适的技术，因为技术没有永远的好坏，只有合不合适。</p> <p>下面章节我们将介绍如何“优雅”的使用 Fetch 以及如何尽量避免掉劣势。</p> <h2 id="如何使用fetch"><a href="#如何使用fetch" aria-hidden="true" class="header-anchor">#</a> 如何使用Fetch</h2> <p>前面了解了这么多基础知识，现在终于到了介绍如何使用 Fetch 了。老规矩，我们先来看下规范定义的接口。</p> <div class="language-js extra-class"><pre class="language-js"><code>partial <span class="token keyword">interface</span> <span class="token class-name">mixin</span> WindowOrWorkerGlobalScope <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>NewObject<span class="token punctuation">]</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span>RequestInfo input<span class="token punctuation">,</span> optional RequestInit init<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>规范中定义的接口我们可以对应着 <a href="https://developer.mozilla.org/" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行查看，你可以点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更直观的看看它的用法。</p> <p>从规范中我们可以看到 fetch 属于 <a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" target="_blank" rel="noopener noreferrer">WindowOrWorkerGlobalScope<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的一部分，暴露在 <a href="https://html.spec.whatwg.org/multipage/window-object.html#window" target="_blank" rel="noopener noreferrer">Window<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或  <a href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" target="_blank" rel="noopener noreferrer">WorkerGlobalScope<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对象上。所以在浏览器中，你可以直接调用 fetch。</p> <p>规范中定义了 fetch 返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它最多可接收两个参数（ input 和 init ）。为了能够对它的使用方法有个更全面的了解，下面来讲一下这两个参数。</p> <ul><li><p>input 参数类型为 <code>RequestInfo</code>，我们可以回到前面的 <code>Request</code> 部分，来回顾一下它的定义。</p> <blockquote><p>typedef (Request or USVString) RequestInfo;</p></blockquote> <p>发现它是一个 <code>Request</code> 对象或者是一个字符串，因此你可以传 <code>Request</code> 实例或者资源地址字符串，这里一般我们推荐使用字符串。</p></li> <li><p>init 参数类型为 <code>RequestInit</code>，我们回顾前面 <code>Requst</code> 部分，它是一个字典类型。在 <code>JavaScript</code> 中你需要传递一个 <code>Object</code> 对象。</p> <blockquote><p>dictionary RequestInit {<br>
ByteString method;<br>
HeadersInit headers;<br>
BodyInit? body;<br>
USVString referrer;<br>
ReferrerPolicy referrerPolicy;<br>
RequestMode mode;<br>
RequestCredentials credentials;<br>
RequestCache cache;<br>
RequestRedirect redirect;<br>
DOMString integrity;<br>
boolean keepalive;<br>
AbortSignal? signal;<br>
any window; // can only be set to null<br>
};</p></blockquote></li></ul> <p>在本小节之前我们都没有介绍 fetch 的使用方式，但是在其他章节中或多或少出现过它的容貌。现在，我们终于可以在这里正式介绍它的使用方式了。</p> <p>fetch 它返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，意味着我们可以通过 <code>then</code> 来获取它的返回值，这样我们可以链式调用。如果配合 <code>async/await</code> 使用，我们的代码可读性会更高。下面我们先通过一个简单的示例来熟悉下它的使用。</p> <h4 id="示例-4"><a href="#示例-4" aria-hidden="true" class="header-anchor">#</a> 示例</h4> <p>示例代码位置：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/views/index.html#L19</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 客户端constheaders= new Headers({</span>
    <span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'fe9'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/data?name=fe'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 GET，不写也可以</span>
      headers<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resData</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> resData<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'发生了一个错误！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的示例中，我们自定义了一个 <code>headers</code> 。为了演示方便，这里我们设定了一个定时器。在请求成功时，服务器端会返回相应的数据，我们通过 <code>Response</code> 实例的 <code>json</code> 方法来解析数据。细心的同学会发现，这里 fetch 的第一个参数我们采用的是字符串，在第二个参数我们提供了一些 <code>RequestInit</code> 配置信息，这里我们指定了请求方法（method）和自定义请求头（headers）。当然你也可以传递一个 <code>Request</code> 实例对象，下面我们也给出一个示例。</p> <p>代码位置：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/views/index.html#L39</p> <div class="language-js extra-class"><pre class="language-js"><code>constheaders<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'X-Token'</span><span class="token punctuation">:</span> <span class="token string">'fe9'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/api/request'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'服务器处理失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fetch-req'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在浏览器中打开：<a href="http://127.0.0.1:4000/%EF%BC%8C" target="_blank" rel="noopener noreferrer">http://127.0.0.1:4000/，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 如果上面的示例运行成功，你将会看到如下界面：</p> <p><img src="https://cdn.nlark.com/yuque/0/2018/png/210399/1544368019579-97c144b3-d81f-4ac4-a1d9-e5e38f6f1ce0.png" alt></p> <p>好，在运行完示例后，相信你应该对如何使用 fetch 有个基本的掌握。在上一章节，我们讲过 fetch 有一定的缺点，下面我们针对部分缺点来尝试着处理下。</p> <h4 id="解决超时"><a href="#解决超时" aria-hidden="true" class="header-anchor">#</a> 解决超时</h4> <p>当网络出现异常，请求可能已经超时，为了使我们的程序更健壮，提供一个较好的用户 体验，我们需要提供一个超时机制。然而，fetch 并不支持，这在上一小节中我们也聊到过。庆幸的是，我们有 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这使得我们有机可趁。我们可以通过自定义封装来达到支持超时机制。下面我们尝试封装下。</p> <div class="language-js extra-class"><pre class="language-js"><code>constdefaultOptions<span class="token operator">=</span> <span class="token punctuation">{</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">.</span>headers <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> abortId<span class="token punctuation">;</span>
    <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      abortId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        timeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>timeout <span class="token operator">||</span> <span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">,</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>checkStatus<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>parseJSON<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>abortId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>abortId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码中，我们需要注意下。就是我们手动根据超时时间来 <code>reject</code> 并不会阻止后续的请求，由于我们并没有关闭掉此次连接，属于是伪取消。fetch 中如果后续接受到服务器的响应，依然会继续处理后续的处理。所以这里我们在 fetch 的第一个 <code>then</code> 中进行了超时判断。</p> <h4 id="取消"><a href="#取消" aria-hidden="true" class="header-anchor">#</a> 取消</h4> <div class="language-js extra-class"><pre class="language-js"><code>constcontroller<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> signal <span class="token operator">=</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">;</span>

  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/data?name=fe'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    signal<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resData</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> resData<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'发生了一个错误！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fetch-str'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们回过头看下 fetch 的接口，发现有一个属性 <code>signal</code>, 类型为<a href="https://dom.spec.whatwg.org/#interface-AbortSignal" target="_blank" rel="noopener noreferrer">AbortSignal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，表示一个信号对象（ signal object ），它允许你通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController" target="_blank" rel="noopener noreferrer">AbortController<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对象与DOM请求进行通信并在需要时将其中止。你可以通过调用  <a href="https://dom.spec.whatwg.org/#dom-abortcontroller-abort" target="_blank" rel="noopener noreferrer">AbortController.abort<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法完成取消操作。</p> <p>当我们需要取消时，fetch 会 reject 一个错误（ AbortError DOMException ），中断你的后续处理逻辑。具体可以看<a href="https://dom.spec.whatwg.org/#abortcontroller-api-integration" target="_blank" rel="noopener noreferrer">规范中的解释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>由于目前 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FetchController" target="_blank" rel="noopener noreferrer">AbortController<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://caniuse.com/#search=AbortController" target="_blank" rel="noopener noreferrer">兼容性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>极差，基本不能使用，但是社区有人帮我们提供了 polyfill（这里我不提供链接，因为目前来说还不适合生产使用，会出现下面所述的问题），我们可以通过使用它来帮助我们提前感受新技术带来的快乐。但是你可能会在原生支持 <code>Fetch</code> 但是又不支持  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FetchController" target="_blank" rel="noopener noreferrer">AbortController<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的情况下，部分浏览器可能会报如下错误：</p> <ul><li><p>Chrome: &quot;Failed to execute 'fetch' on 'Window': member signal is not of type AbortSignal.&quot;</p></li> <li><p>Firefox: &quot;'signal' member of RequestInit does not implement interface AbortSignal.&quot;</p></li></ul> <p>如果出现以上问题，我们也无能为力，可能原因是浏览器内部做了严格验证，对比发现我们提供的 <code>signal</code> 类型不对。</p> <p>但是我们可以通过手动 <code>reject</code> 的方式达到取消，但是这种属于伪取消，实际上连接并没有关闭。我们可以通过自定义配置，例如在 <code>options</code> 中增加配置，暴露出 <code>reject</code>，这样我们就可以在外面来取消掉。这里本人暂时不提供代码。有兴趣的同学可以尝试一下，也可以在下面的评论区评论。</p> <p>前面提到过的获取进度目前我们还无法实现。</p> <h3 id="拦截器"><a href="#拦截器" aria-hidden="true" class="header-anchor">#</a> 拦截器</h3> <p>示例代码位置：https://github.com/GoDotDotDot/fe9-fetch-demo/blob/master/request.js</p> <p>下面我们讲一讲如何做一个简单的拦截器，这里的拦截器指对响应做拦截。假设我们需要对接口返回的状态码进行解析，例如 403 或者 401 需要跳转到登录页面，200 正常放行，其他报错。由于 fetch 返回一个  <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这就使得我们可以在后续的 <code>then</code> 中做些简单的拦截。我们看一下示例代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">functionparseJSON</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">204</span> <span class="token operator">||</span> status<span class="token operator">===</span><span class="token number">205</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    returnnull<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">checkStatus</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 权限不允许则跳转到登陆页面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">403</span> <span class="token operator">||</span> status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window <span class="token operator">?</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'/login.html'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  error<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
  * @description 默认配置
  * 设置请求头为json
  */</span>
<span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// credentials: 'include', // 跨域传递cookie</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
  * Requests a URL, returning a promise
  *
  * @param  {string} url       The URL we want to request
  * @param  {object} [options] The options we want to pass to &quot;fetch&quot;
  *
  * @return {object}           The response data
  */</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">.</span>headers <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> abortId<span class="token punctuation">;</span>
    <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      abortId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        timeout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>timeout <span class="token operator">||</span> <span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">,</span> headers <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'timeout!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>checkStatus<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>parseJSON<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>abortId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>abortId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上面的 <code>checkStatus</code> 代码中我们可以看到，我们首先检查了状态码。当状态码为 403 或 401 时，我们将页面跳转到了 login 登录页面。细心的同学还会发现，我们多了一个处理方法就是 <code>parseJSON</code>，这里由于我们的后端统一返回 json 数据，为了方便，我们就直接统一处理了 json 数据。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>本系列文章整体阐述了 fetch 的基本概念、和 XHR 的差异、如何使用 fetch 以及我们常见的解决方案。希望同学们在读完整篇文章能够对 fetch 的认识有所加深。</p> <p><strong>建议</strong>：在整体了解了 fetch 之后，希望同学们能够读一下 <a href="https://github.com/github/fetch" target="_blank" rel="noopener noreferrer">github polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 源码。在读代码的同时，可以同时参考 <a href="https://fetch.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">Fetch 规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>参考：</p> <ol><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">MDN Fetch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://fetch.spec.whatwg.org/" target="_blank" rel="noopener noreferrer">Fetch 规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/GoDotDotDot/fe9-fetch-demo/" target="_blank" rel="noopener noreferrer">示例代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/fe-notes/Frontend/CodeStyle/页面优化.html">
          页面优化
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/fe-notes/assets/js/app.a315cfb5.js" defer></script><script src="/fe-notes/assets/js/23.2b5c528b.js" defer></script>
  </body>
</html>
