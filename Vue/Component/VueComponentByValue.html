<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue组件间通信六种方式（完整版） | 余生的前端笔记本</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="description" content="记录平凡">
    <link rel="preload" href="/xn213/assets/css/0.styles.ca63e153.css" as="style"><link rel="preload" href="/xn213/assets/js/app.d4906252.js" as="script"><link rel="preload" href="/xn213/assets/js/2.51fac5b8.js" as="script"><link rel="preload" href="/xn213/assets/js/98.417f15c6.js" as="script"><link rel="prefetch" href="/xn213/assets/js/10.1faf398f.js"><link rel="prefetch" href="/xn213/assets/js/100.7a74ebc8.js"><link rel="prefetch" href="/xn213/assets/js/101.4f40be2a.js"><link rel="prefetch" href="/xn213/assets/js/102.c8d7cea6.js"><link rel="prefetch" href="/xn213/assets/js/103.270122d2.js"><link rel="prefetch" href="/xn213/assets/js/104.d4a4e842.js"><link rel="prefetch" href="/xn213/assets/js/105.3f397b90.js"><link rel="prefetch" href="/xn213/assets/js/106.918e93a8.js"><link rel="prefetch" href="/xn213/assets/js/107.bed93497.js"><link rel="prefetch" href="/xn213/assets/js/108.8560db9a.js"><link rel="prefetch" href="/xn213/assets/js/109.3d45cd73.js"><link rel="prefetch" href="/xn213/assets/js/11.6bf048df.js"><link rel="prefetch" href="/xn213/assets/js/110.1a0c24e2.js"><link rel="prefetch" href="/xn213/assets/js/111.3fecca9a.js"><link rel="prefetch" href="/xn213/assets/js/112.4acafde9.js"><link rel="prefetch" href="/xn213/assets/js/113.0138919a.js"><link rel="prefetch" href="/xn213/assets/js/114.b6f3a7bb.js"><link rel="prefetch" href="/xn213/assets/js/115.03d6018c.js"><link rel="prefetch" href="/xn213/assets/js/116.9da7bcd2.js"><link rel="prefetch" href="/xn213/assets/js/117.b00f571c.js"><link rel="prefetch" href="/xn213/assets/js/118.805693d4.js"><link rel="prefetch" href="/xn213/assets/js/12.1366bf4e.js"><link rel="prefetch" href="/xn213/assets/js/13.8469840d.js"><link rel="prefetch" href="/xn213/assets/js/14.476bf2b4.js"><link rel="prefetch" href="/xn213/assets/js/15.73262e19.js"><link rel="prefetch" href="/xn213/assets/js/16.a84e4240.js"><link rel="prefetch" href="/xn213/assets/js/17.3be54d85.js"><link rel="prefetch" href="/xn213/assets/js/18.500d10d8.js"><link rel="prefetch" href="/xn213/assets/js/19.8474792d.js"><link rel="prefetch" href="/xn213/assets/js/20.c4c313bc.js"><link rel="prefetch" href="/xn213/assets/js/21.b0881497.js"><link rel="prefetch" href="/xn213/assets/js/22.d5268e49.js"><link rel="prefetch" href="/xn213/assets/js/23.58ca6578.js"><link rel="prefetch" href="/xn213/assets/js/24.a3e7d50c.js"><link rel="prefetch" href="/xn213/assets/js/25.16abe053.js"><link rel="prefetch" href="/xn213/assets/js/26.86c0a1e4.js"><link rel="prefetch" href="/xn213/assets/js/27.7030e691.js"><link rel="prefetch" href="/xn213/assets/js/28.deb79169.js"><link rel="prefetch" href="/xn213/assets/js/29.6eaaf04b.js"><link rel="prefetch" href="/xn213/assets/js/3.b7850748.js"><link rel="prefetch" href="/xn213/assets/js/30.2506a5c4.js"><link rel="prefetch" href="/xn213/assets/js/31.26cfc1d9.js"><link rel="prefetch" href="/xn213/assets/js/32.0a4b2fe0.js"><link rel="prefetch" href="/xn213/assets/js/33.36d9b152.js"><link rel="prefetch" href="/xn213/assets/js/34.2b9dc880.js"><link rel="prefetch" href="/xn213/assets/js/35.2567933d.js"><link rel="prefetch" href="/xn213/assets/js/36.23821499.js"><link rel="prefetch" href="/xn213/assets/js/37.46a4d915.js"><link rel="prefetch" href="/xn213/assets/js/38.78a550d5.js"><link rel="prefetch" href="/xn213/assets/js/39.d61eb27d.js"><link rel="prefetch" href="/xn213/assets/js/4.7e99a2d3.js"><link rel="prefetch" href="/xn213/assets/js/40.933a08eb.js"><link rel="prefetch" href="/xn213/assets/js/41.a470035a.js"><link rel="prefetch" href="/xn213/assets/js/42.fc89c186.js"><link rel="prefetch" href="/xn213/assets/js/43.15247d93.js"><link rel="prefetch" href="/xn213/assets/js/44.ab9e5f68.js"><link rel="prefetch" href="/xn213/assets/js/45.d347fb15.js"><link rel="prefetch" href="/xn213/assets/js/46.3dbf0169.js"><link rel="prefetch" href="/xn213/assets/js/47.bc6372ae.js"><link rel="prefetch" href="/xn213/assets/js/48.a455dd6a.js"><link rel="prefetch" href="/xn213/assets/js/49.42512fc4.js"><link rel="prefetch" href="/xn213/assets/js/5.9753c03c.js"><link rel="prefetch" href="/xn213/assets/js/50.d154eba7.js"><link rel="prefetch" href="/xn213/assets/js/51.615c6988.js"><link rel="prefetch" href="/xn213/assets/js/52.826146fc.js"><link rel="prefetch" href="/xn213/assets/js/53.86dca864.js"><link rel="prefetch" href="/xn213/assets/js/54.5537cce4.js"><link rel="prefetch" href="/xn213/assets/js/55.7e134c54.js"><link rel="prefetch" href="/xn213/assets/js/56.84100376.js"><link rel="prefetch" href="/xn213/assets/js/57.6b67fd76.js"><link rel="prefetch" href="/xn213/assets/js/58.9b9f3130.js"><link rel="prefetch" href="/xn213/assets/js/59.f3e68bcf.js"><link rel="prefetch" href="/xn213/assets/js/6.a4f112fa.js"><link rel="prefetch" href="/xn213/assets/js/60.a4243a5c.js"><link rel="prefetch" href="/xn213/assets/js/61.29628b38.js"><link rel="prefetch" href="/xn213/assets/js/62.3f0b67b9.js"><link rel="prefetch" href="/xn213/assets/js/63.910061cb.js"><link rel="prefetch" href="/xn213/assets/js/64.48d637e0.js"><link rel="prefetch" href="/xn213/assets/js/65.a11ce1db.js"><link rel="prefetch" href="/xn213/assets/js/66.c7d82608.js"><link rel="prefetch" href="/xn213/assets/js/67.ee9cd709.js"><link rel="prefetch" href="/xn213/assets/js/68.37ca6255.js"><link rel="prefetch" href="/xn213/assets/js/69.fb07e58e.js"><link rel="prefetch" href="/xn213/assets/js/7.f165d4ad.js"><link rel="prefetch" href="/xn213/assets/js/70.c6515a0e.js"><link rel="prefetch" href="/xn213/assets/js/71.c6d65667.js"><link rel="prefetch" href="/xn213/assets/js/72.edd126d5.js"><link rel="prefetch" href="/xn213/assets/js/73.c8230ab6.js"><link rel="prefetch" href="/xn213/assets/js/74.9169bdfa.js"><link rel="prefetch" href="/xn213/assets/js/75.7f969006.js"><link rel="prefetch" href="/xn213/assets/js/76.7f70450f.js"><link rel="prefetch" href="/xn213/assets/js/77.84b9567f.js"><link rel="prefetch" href="/xn213/assets/js/78.ec259083.js"><link rel="prefetch" href="/xn213/assets/js/79.0f38cf96.js"><link rel="prefetch" href="/xn213/assets/js/8.93badb4c.js"><link rel="prefetch" href="/xn213/assets/js/80.00d59f1a.js"><link rel="prefetch" href="/xn213/assets/js/81.296081e7.js"><link rel="prefetch" href="/xn213/assets/js/82.1a7bb394.js"><link rel="prefetch" href="/xn213/assets/js/83.49934a5f.js"><link rel="prefetch" href="/xn213/assets/js/84.8302d481.js"><link rel="prefetch" href="/xn213/assets/js/85.5b6eca11.js"><link rel="prefetch" href="/xn213/assets/js/86.9cd3ce36.js"><link rel="prefetch" href="/xn213/assets/js/87.909f3fbe.js"><link rel="prefetch" href="/xn213/assets/js/88.97d3b017.js"><link rel="prefetch" href="/xn213/assets/js/89.eb9b8edc.js"><link rel="prefetch" href="/xn213/assets/js/9.48527424.js"><link rel="prefetch" href="/xn213/assets/js/90.81ddc649.js"><link rel="prefetch" href="/xn213/assets/js/91.ea383d56.js"><link rel="prefetch" href="/xn213/assets/js/92.31ffb78c.js"><link rel="prefetch" href="/xn213/assets/js/93.6f5a3c6c.js"><link rel="prefetch" href="/xn213/assets/js/94.3092c543.js"><link rel="prefetch" href="/xn213/assets/js/95.1396fb1e.js"><link rel="prefetch" href="/xn213/assets/js/96.d7c769c9.js"><link rel="prefetch" href="/xn213/assets/js/97.5c6b604b.js"><link rel="prefetch" href="/xn213/assets/js/99.c8d339c0.js">
    <link rel="stylesheet" href="/xn213/assets/css/0.styles.ca63e153.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xn213/" class="home-link router-link-active"><!----> <span class="site-name">余生的前端笔记本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xn213/Computer/" class="nav-link">
  计算机
</a></div><div class="nav-item"><a href="/xn213/Frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/xn213/Notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/xn213/Interview/" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/xn213/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/xn213/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/xn213/Vue/VueBasic/VueRespond.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/xn213/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/xn213/CodeTools/VSCode/VSCodeVue.html" class="nav-link">
  CodeTools
</a></div><div class="nav-item"><a href="/xn213/DZH/Explain.html" class="nav-link">
  大杂烩
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xn213/Computer/" class="nav-link">
  计算机
</a></div><div class="nav-item"><a href="/xn213/Frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/xn213/Notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/xn213/Interview/" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/xn213/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/xn213/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/xn213/Vue/VueBasic/VueRespond.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/xn213/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/xn213/CodeTools/VSCode/VSCodeVue.html" class="nav-link">
  CodeTools
</a></div><div class="nav-item"><a href="/xn213/DZH/Explain.html" class="nav-link">
  大杂烩
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VueJs 项目实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue Component</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xn213/Vue/Component/VueComponentByValue.html" class="active sidebar-link">vue组件间通信六种方式（完整版）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法一、props-emit" class="sidebar-link">方法一、props/$emit</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法二、-emit-on" class="sidebar-link">方法二、$emit/$on</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法三、vuex" class="sidebar-link">方法三、vuex</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法四、-attrs-listeners" class="sidebar-link">方法四、$attrs/$listeners</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法五、provide-inject" class="sidebar-link">方法五、provide/inject</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#方法六、-parent-children与-ref" class="sidebar-link">方法六、$parent / $children与 ref</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/xn213/Vue/Component/VueComponentByValue.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><a href="/xn213/Vue/Component/HowToCodeBestComponents.html" class="sidebar-link">如何写好一个 vue 组件</a></li><li><a href="/xn213/Vue/Component/TongYongCom-notification.html" class="sidebar-link">通用组件 notification 信息提示弹框</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue Router</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue 移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue 遇到的问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue 源码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xn213/Vue/Vue/vue-prototype.html" class="sidebar-link">Vue 构造函数整理-原型</a></li><li><a href="/xn213/Vue/Vue/vue-global-api.html" class="sidebar-link">Vue 构造函数整理-全局API</a></li><li><a href="/xn213/Vue/Vue/vue-ins.html" class="sidebar-link">Vue 实例的设计</a></li><li><a href="/xn213/Vue/Vue/从源码学习之Vue面试题目.html" class="sidebar-link">Vue 从源码学习之面试题目</a></li><li><a href="/xn213/Vue/Vue/Vue源码中的高级js.html" class="sidebar-link">Vue 从源码学习之 JS 骚操作</a></li><li><a href="/xn213/Vue/Vue/vue-props.html" class="sidebar-link">Vue 从源码学习之 Vue选项Props</a></li><li><a href="/xn213/Vue/Vue/shared-util.html" class="sidebar-link">shared/util.js 文件工具方法全解</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue组件间通信六种方式（完整版）"><a href="#vue组件间通信六种方式（完整版）" class="header-anchor">#</a> vue组件间通信六种方式（完整版）</h1> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>组件是 vue.js最强大的功能之一，而组件实例的作用域是相互独立的，这就意味着不同组件之间的数据无法相互引用。一般来说，组件可以有以下几种关系：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf70530315?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p> <p>如上图所示，A 和 B、B 和 C、B 和 D 都是父子关系，C 和 D 是兄弟关系，A 和 C 是隔代关系（可能隔多代）。</p> <p>针对不同的使用场景，如何选择行之有效的通信方式？这是我们所要探讨的主题。本文总结了vue组件间通信的几种方式，如props、<code>$emit</code>/<code>$on</code>、vuex、<code>$parent</code> / <code>$children</code>、<code>$attrs</code>/<code>$listeners</code>和provide/inject，以通俗易懂的实例讲述这其中的差别及使用场景，希望对小伙伴有些许帮助。</p> <p>本文的代码请猛戳<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fljianshu%2FBlog%2Ftree%2Fmaster%2Fvue2.0%25E5%25AD%25A6%25E4%25B9%25A0" target="_blank" rel="noopener noreferrer">github博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，纸上得来终觉浅，大家动手多敲敲代码！</p> <h2 id="方法一、props-emit"><a href="#方法一、props-emit" class="header-anchor">#</a> 方法一、<code>props</code>/<code>$emit</code></h2> <p>父组件A通过props的方式向子组件B传递，B to A 通过在 B 组件中 $emit, A 组件中 v-on 的方式实现。</p> <h3 id="_1-父组件向子组件传值"><a href="#_1-父组件向子组件传值" class="header-anchor">#</a> 1.父组件向子组件传值</h3> <p>接下来我们通过一个例子，说明父组件如何向子组件传递值：在子组件Users.vue中如何获取父组件App.vue中的数据 <code>users:[&quot;Henry&quot;,&quot;Bucky&quot;,&quot;Emily&quot;]</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>//App.vue父组件
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>users v-bind:users<span class="token operator">=</span><span class="token string">&quot;users&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/users<span class="token operator">&gt;</span>//前者自定义名称便于子组件调用，后者要传递数据名
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token function">import</span> Users from <span class="token string">&quot;./components/Users&quot;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  name: <span class="token string">'App'</span>,
  <span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    return<span class="token punctuation">{</span>
      users:<span class="token punctuation">[</span><span class="token string">&quot;Henry&quot;</span>,<span class="token string">&quot;Bucky&quot;</span>,<span class="token string">&quot;Emily&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  components:<span class="token punctuation">{</span>
    <span class="token string">&quot;users&quot;</span>:Users
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>//users子组件
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">&quot;hello&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li v-for<span class="token operator">=</span><span class="token string">&quot;user in users&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>//遍历传递过来的值，然后呈现到页面
    <span class="token operator">&lt;</span>/ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  name: <span class="token string">'HelloWorld'</span>,
  props:<span class="token punctuation">{</span>
    users:<span class="token punctuation">{</span>           //这个就是父组件中子标签自定义名字
      type:Array,
      required:true
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>总结：父组件通过props向下传递数据给子组件。注：组件中的数据共有三种形式：data、props、computed</strong></p> <h3 id="_2-子组件向父组件传值（通过事件形式）"><a href="#_2-子组件向父组件传值（通过事件形式）" class="header-anchor">#</a> 2.子组件向父组件传值（通过事件形式）</h3> <p>接下来我们通过一个例子，说明子组件如何向父组件传递值：当我们点击“Vue.js Demo”后，子组件向父组件传递值，文字由原来的“传递的是一个值”变成“子向父组件传值”，实现子组件向父组件值的传递。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf70ac2d51?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="子组件向父组件传值之前"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// 子组件
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1 @click<span class="token operator">=</span><span class="token string">&quot;changeTitle&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>//绑定一个点击事件
  <span class="token operator">&lt;</span>/header<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  name: <span class="token string">'app-header'</span>,
  <span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
      title:<span class="token string">&quot;Vue.js Demo&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  methods:<span class="token punctuation">{</span>
    <span class="token function-name function">changeTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.<span class="token variable">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;titleChanged&quot;</span>,<span class="token string">&quot;子向父组件传值&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//自定义事件  传递值“子向父组件传值”
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// 父组件
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>app-header v-on:titleChanged<span class="token operator">=</span><span class="token string">&quot;updateTitle&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>/app-header<span class="token operator">&gt;</span>//与子组件titleChanged自定义事件保持一致
   // updateTitle<span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span>接受传递过来的文字
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token function">import</span> Header from <span class="token string">&quot;./components/Header&quot;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  name: <span class="token string">'App'</span>,
  <span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    return<span class="token punctuation">{</span>
      title:<span class="token string">&quot;传递的是一个值&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  methods:<span class="token punctuation">{</span>
    updateTitle<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>   //声明这个函数
      this.title <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  components:<span class="token punctuation">{</span>
   <span class="token string">&quot;app-header&quot;</span>:Header,
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>总结：子组件通过events给父组件发送消息，实际上就是子组件把自己的数据发送到父组件。</strong></p> <h2 id="方法二、-emit-on"><a href="#方法二、-emit-on" class="header-anchor">#</a> 方法二、<code>$emit</code>/<code>$on</code></h2> <p><strong>这种方法通过一个空的Vue实例作为中央事件总线（事件中心），用它来触发事件和监听事件,巧妙而轻量地实现了任何组件间的通信，包括父子、兄弟、跨级</strong>。当我们的项目比较大时，可以选择更好的状态管理解决方案vuex。</p> <h4 id="_1-具体实现方式："><a href="#_1-具体实现方式：" class="header-anchor">#</a> 1.具体实现方式：</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>var <span class="token assign-left variable">Event</span><span class="token operator">=</span>new Vue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Event.<span class="token variable">$emit</span><span class="token punctuation">(</span>事件名,数据<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Event.<span class="token variable">$on</span><span class="token punctuation">(</span>事件名,data <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-举个例子"><a href="#_2-举个例子" class="header-anchor">#</a> 2.举个例子</h4> <p>假设兄弟组件有三个，分别是A、B、C组件，C组件如何获取A或者B组件的数据</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;itany&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>my-a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/my-a<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>my-b<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/my-b<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>my-c<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/my-c<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>A组件：<span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;send&quot;</span><span class="token operator">&gt;</span>将数据发送给C组件<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;b&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>B组件：<span class="token punctuation">{</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;send&quot;</span><span class="token operator">&gt;</span>将数组发送给C组件<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;c&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>C组件：<span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span>，<span class="token punctuation">{</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
var Event <span class="token operator">=</span> new Vue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//定义一个空的Vue实例
var A <span class="token operator">=</span> <span class="token punctuation">{</span>
	template: <span class="token string">'#a'</span>,
	<span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
	    name: <span class="token string">'tom'</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>,
	methods: <span class="token punctuation">{</span>
	  <span class="token function-name function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    Event.<span class="token variable">$emit</span><span class="token punctuation">(</span><span class="token string">'data-a'</span>, this.name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
var B <span class="token operator">=</span> <span class="token punctuation">{</span>
	template: <span class="token string">'#b'</span>,
	<span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
	    age: <span class="token number">20</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>,
	methods: <span class="token punctuation">{</span>
	  <span class="token function-name function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    Event.<span class="token variable">$emit</span><span class="token punctuation">(</span><span class="token string">'data-b'</span>, this.age<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
var C <span class="token operator">=</span> <span class="token punctuation">{</span>
	template: <span class="token string">'#c'</span>,
	<span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
	    name: <span class="token string">''</span>,
	    age: <span class="token string">&quot;&quot;</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>,
	<span class="token function-name function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>//在模板编译完成后执行
	 Event.<span class="token variable">$on</span><span class="token punctuation">(</span><span class="token string">'data-a'</span>,name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	     this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>//箭头函数内部不会产生新的this，这边如果不用<span class="token operator">=</span><span class="token operator">&gt;</span>,this指代Event
	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
	 Event.<span class="token variable">$on</span><span class="token punctuation">(</span><span class="token string">'data-b'</span>,age <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	     this.age <span class="token operator">=</span> age<span class="token punctuation">;</span>
	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
var vm <span class="token operator">=</span> new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
	el: <span class="token string">'#itany'</span>,
	components: <span class="token punctuation">{</span>
	  <span class="token string">'my-a'</span><span class="token builtin class-name">:</span> A,
	  <span class="token string">'my-b'</span><span class="token builtin class-name">:</span> B,
	  <span class="token string">'my-c'</span><span class="token builtin class-name">:</span> C
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf70b00507?imageslim" alt=""></p> <p><code>$on</code> 监听了自定义事件 data-a和data-b，因为有时不确定何时会触发事件，一般会在 mounted 或 created 钩子中来监听。</p> <h2 id="方法三、vuex"><a href="#方法三、vuex" class="header-anchor">#</a> 方法三、vuex</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf70ef8eb1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p> <h3 id="_1-简要介绍vuex原理"><a href="#_1-简要介绍vuex原理" class="header-anchor">#</a> 1.简要介绍Vuex原理</h3> <p>Vuex实现了一个单向数据流，在全局拥有一个State存放数据，当组件要更改State中的数据时，必须通过Mutation进行，Mutation同时提供了订阅者模式供外部插件调用获取State数据的更新。而当所有异步操作(常见于调用后端接口异步获取更新数据)或批量的同步操作需要走Action，但Action也是无法直接修改State的，还是需要通过Mutation来修改State的数据。最后，根据State的变化，渲染到视图上。</p> <h3 id="_2-简要介绍各模块在流程中的功能："><a href="#_2-简要介绍各模块在流程中的功能：" class="header-anchor">#</a> 2.简要介绍各模块在流程中的功能：</h3> <ul><li>Vue Components：Vue组件。HTML页面上，负责接收用户操作等交互行为，执行dispatch方法触发对应action进行回应。</li> <li>dispatch：操作行为触发方法，是唯一能执行action的方法。</li> <li>actions：<strong>操作行为处理模块,由组件中的<code>$store.dispatch('action 名称', data1)</code>来触发。然后由commit()来触发mutation的调用 , 间接更新 state</strong>。负责处理Vue Components接收到的所有交互行为。包含同步/异步操作，支持多个同名方法，按照注册的顺序依次触发。向后台API请求的操作就在这个模块中进行，包括触发其他action以及提交mutation的操作。该模块提供了Promise的封装，以支持action的链式触发。</li> <li>commit：状态改变提交操作方法。对mutation进行提交，是唯一能执行mutation的方法。</li> <li>mutations：<strong>状态改变操作方法，由actions中的<code>commit('mutation 名称')</code>来触发</strong>。是Vuex修改state的唯一推荐方法。该方法只能进行同步操作，且方法名只能全局唯一。操作之中会有一些hook暴露出来，以进行state的监控等。</li> <li>state：页面状态管理容器对象。集中存储Vue components中data对象的零散数据，全局唯一，以进行统一的状态管理。页面显示所需的数据从该对象中进行读取，利用Vue的细粒度数据响应机制来进行高效的状态更新。</li> <li>getters：state对象读取方法。图中没有单独列出该模块，应该被包含在了render中，Vue Components通过该方法读取全局state对象。</li></ul> <h3 id="_3-vuex与localstorage"><a href="#_3-vuex与localstorage" class="header-anchor">#</a> 3.Vuex与localStorage</h3> <p>vuex 是 vue 的状态管理器，存储的数据是响应式的。但是并不会保存起来，刷新之后就回到了初始状态，<strong>具体做法应该在vuex里数据改变的时候把数据拷贝一份保存到localStorage里面，刷新之后，如果localStorage里有保存的数据，取出来再替换store里的state。</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">let</span> defaultCity <span class="token operator">=</span> <span class="token string">&quot;上海&quot;</span>
try <span class="token punctuation">{</span>   // 用户关闭了本地存储功能，此时在外层加个try<span class="token punctuation">..</span>.catch
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>defaultCity<span class="token punctuation">)</span><span class="token punctuation">{</span>
    defaultCity <span class="token operator">=</span> JSON.parse<span class="token punctuation">(</span>window.localStorage.getItem<span class="token punctuation">(</span><span class="token string">'defaultCity'</span><span class="token punctuation">))</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>catch<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token builtin class-name">export</span> default new Vuex.Store<span class="token punctuation">(</span><span class="token punctuation">{</span>
  state: <span class="token punctuation">{</span>
    city: defaultCity
  <span class="token punctuation">}</span>,
  mutations: <span class="token punctuation">{</span>
    changeCity<span class="token punctuation">(</span>state, city<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state.city <span class="token operator">=</span> city
      try <span class="token punctuation">{</span>
      window.localStorage.setItem<span class="token punctuation">(</span><span class="token string">'defaultCity'</span>, JSON.stringify<span class="token punctuation">(</span>state.city<span class="token punctuation">))</span><span class="token punctuation">;</span>
      // 数据改变的时候把数据拷贝一份保存到localStorage里面
      <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这里需要注意的是：由于vuex里，我们保存的状态，都是数组，而localStorage只支持字符串，所以需要用JSON转换：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>JSON.stringify<span class="token punctuation">(</span>state.subscribeList<span class="token punctuation">)</span><span class="token punctuation">;</span>   // array -<span class="token operator">&gt;</span> string
JSON.parse<span class="token punctuation">(</span>window.localStorage.getItem<span class="token punctuation">(</span><span class="token string">&quot;subscribeList&quot;</span><span class="token punctuation">))</span><span class="token punctuation">;</span>    // string -<span class="token operator">&gt;</span> array 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="方法四、-attrs-listeners"><a href="#方法四、-attrs-listeners" class="header-anchor">#</a> 方法四、<code>$attrs</code>/<code>$listeners</code></h2> <h4 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1.简介</h4> <p>多级组件嵌套需要传递数据时，通常使用的方法是通过vuex。但如果仅仅是传递数据，而不做中间处理，使用 vuex 处理，未免有点大材小用。为此Vue2.4 版本提供了另一种方法----<code>$attrs</code>/<code>$listeners</code></p> <ul><li><p><code>$attrs</code>：包含了父作用域中不被 prop 所识别 (且获取) 的特性绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (class 和 style 除外)，并且可以通过 v-bind=&quot;$attrs&quot; 传入内部组件。通常配合 interitAttrs 选项一起使用。</p></li> <li><p><code>$listeners</code>：包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on=&quot;$listeners&quot; 传入内部组件</p></li></ul> <p>接下来我们看个跨级通信的例子：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// index.vue
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>浪里行舟<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
    <span class="token operator">&lt;</span>child-com1
      :foo<span class="token operator">=</span><span class="token string">&quot;foo&quot;</span>
      :boo<span class="token operator">=</span><span class="token string">&quot;boo&quot;</span>
      :coo<span class="token operator">=</span><span class="token string">&quot;coo&quot;</span>
      :doo<span class="token operator">=</span><span class="token string">&quot;doo&quot;</span>
      <span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token string">&quot;前端工匠&quot;</span>
    <span class="token operator">&gt;</span><span class="token operator">&lt;</span>/child-com<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
const childCom1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> import<span class="token punctuation">(</span><span class="token string">&quot;./childCom1.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  components: <span class="token punctuation">{</span> childCom1 <span class="token punctuation">}</span>,
  <span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
      foo: <span class="token string">&quot;Javascript&quot;</span>,
      boo: <span class="token string">&quot;Html&quot;</span>,
      coo: <span class="token string">&quot;CSS&quot;</span>,
      doo: <span class="token string">&quot;Vue&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// childCom1.vue
<span class="token operator">&lt;</span>template <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">&quot;border&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>foo: <span class="token punctuation">{</span><span class="token punctuation">{</span> foo <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>childCom1的<span class="token variable">$attrs</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$attrs</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>child-com2 v-bind<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$attrs</span>&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/child-com<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
const childCom2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> import<span class="token punctuation">(</span><span class="token string">&quot;./childCom2.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  components: <span class="token punctuation">{</span>
    childCom2
  <span class="token punctuation">}</span>,
  inheritAttrs: false, // 可以关闭自动挂载到组件根元素上的没有在props声明的属性
  props: <span class="token punctuation">{</span>
    foo: String // foo作为props属性绑定
  <span class="token punctuation">}</span>,
  <span class="token function-name function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.<span class="token variable">$attrs</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token punctuation">{</span> <span class="token string">&quot;boo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Html&quot;</span>, <span class="token string">&quot;coo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CSS&quot;</span>, <span class="token string">&quot;doo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Vue&quot;</span>, <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;前端工匠&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// childCom2.vue
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">&quot;border&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>boo: <span class="token punctuation">{</span><span class="token punctuation">{</span> boo <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>childCom2: <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$attrs</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>child-com3 v-bind<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$attrs</span>&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/child-com<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
const childCom3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> import<span class="token punctuation">(</span><span class="token string">&quot;./childCom3.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  components: <span class="token punctuation">{</span>
    childCom3
  <span class="token punctuation">}</span>,
  inheritAttrs: false,
  props: <span class="token punctuation">{</span>
    boo: String
  <span class="token punctuation">}</span>,
  <span class="token function-name function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.<span class="token variable">$attrs</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token punctuation">{</span> <span class="token string">&quot;boo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Html&quot;</span>, <span class="token string">&quot;coo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CSS&quot;</span>, <span class="token string">&quot;doo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Vue&quot;</span>, <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;前端工匠&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// childCom3.vue
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">&quot;border&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>childCom3: <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$attrs</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  props: <span class="token punctuation">{</span>
    coo: String,
    title: String
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf77e44744?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p> <p>如上图所示<code>$attrs</code>表示没有继承数据的对象，格式为{属性名：属性值}。Vue2.4提供了<code>$attrs</code> , <code>$listeners</code> 来传递数据与事件，跨级组件之间的通讯变得更简单。</p> <p>简单来说：<code>$attrs</code>与<code>$listeners</code> 是两个对象，<code>$attrs</code> 里存放的是父组件中绑定的非 Props 属性，<code>$listeners</code>里存放的是父组件中绑定的非原生事件。</p> <h2 id="方法五、provide-inject"><a href="#方法五、provide-inject" class="header-anchor">#</a> 方法五、provide/inject</h2> <h4 id="_1-简介-2"><a href="#_1-简介-2" class="header-anchor">#</a> 1.简介</h4> <p>Vue2.2.0新增API,这对选项需要一起使用，<strong>以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效</strong>。一言而蔽之：祖先组件中通过provider来提供变量，然后在子孙组件中通过inject来注入变量。
<strong>provide / inject API 主要解决了跨级组件间的通信问题，不过它的使用场景，主要是子组件获取上级组件的状态，跨级组件间建立了一种主动提供与依赖注入的关系</strong>。</p> <h4 id="_2-举个例子-2"><a href="#_2-举个例子-2" class="header-anchor">#</a> 2.举个例子</h4> <p>假设有两个组件： A.vue 和 B.vue，B 是 A 的子组件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// A.vue
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  provide: <span class="token punctuation">{</span>
    name: <span class="token string">'浪里行舟'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// B.vue
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  inject: <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>,
  <span class="token function-name function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.name<span class="token punctuation">)</span><span class="token punctuation">;</span>  // 浪里行舟
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到，在 A.vue 里，我们设置了一个 <strong>provide: name</strong>，值为 浪里行舟，它的作用就是将 <strong>name</strong> 这个变量提供给它的所有子组件。而在 B.vue 中，通过 <code>inject</code> 注入了从 A 组件中提供的 <strong>name</strong> 变量，那么在组件 B 中，就可以直接通过 <strong>this.name</strong> 访问这个变量了，它的值也是 浪里行舟。这就是 provide / inject API 最核心的用法。</p> <p>需要注意的是：<strong>provide 和 inject 绑定并不是可响应的。这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的</strong>----vue官方文档
所以，上面 A.vue 的 name 如果改变了，B.vue 的 this.name 是不会改变的，仍然是 浪里行舟。</p> <h4 id="_3-provide与inject-怎么实现数据响应式"><a href="#_3-provide与inject-怎么实现数据响应式" class="header-anchor">#</a> 3.provide与inject 怎么实现数据响应式</h4> <p>一般来说，有两种办法：</p> <ul><li>provide祖先组件的实例，然后在子孙组件中注入依赖，这样就可以在子孙组件中直接修改祖先组件的实例的属性，不过这种方法有个缺点就是这个实例上挂载很多没有必要的东西比如props，methods</li> <li>使用2.6最新API Vue.observable 优化响应式 provide(推荐)</li></ul> <p>我们来看个例子：孙组件D、E和F获取A组件传递过来的color值，并能实现数据响应式变化，即A组件的color变化后，组件D、E、F不会跟着变（核心代码如下：）</p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/17/16ac35bf7131f3db?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// A 组件 
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>A 组件<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;() =&gt; changeColor()&quot;</span><span class="token operator">&gt;</span>改变color<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ChildrenB /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ChildrenC /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
  <span class="token function-name function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
      color: <span class="token string">&quot;blue&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>,
  // <span class="token function-name function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  //   <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
  //     theme: <span class="token punctuation">{</span>
  //       color: this.color //这种方式绑定的数据并不是可响应的
  //     <span class="token punctuation">}</span> // 即A组件的color变化后，组件D、E、F不会跟着变
  //   <span class="token punctuation">}</span><span class="token punctuation">;</span>
  // <span class="token punctuation">}</span>,
  <span class="token function-name function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
      theme: this//方法一：提供祖先组件的实例
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>,
  methods: <span class="token punctuation">{</span>
    changeColor<span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.color <span class="token operator">=</span> color<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        this.color <span class="token operator">=</span> this.color <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&quot;blue&quot;</span> ? <span class="token string">&quot;red&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  // 方法二:使用2.6最新API Vue.observable 优化响应式 provide
  // <span class="token function-name function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  //   this.theme <span class="token operator">=</span> Vue.observable<span class="token punctuation">(</span><span class="token punctuation">{</span>
  //     color: <span class="token string">&quot;blue&quot;</span>
  //   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  //   <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
  //     theme: this.theme
  //   <span class="token punctuation">}</span><span class="token punctuation">;</span>
  // <span class="token punctuation">}</span>,
  // methods: <span class="token punctuation">{</span>
  //   changeColor<span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  //     <span class="token keyword">if</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  //       this.theme.color <span class="token operator">=</span> color<span class="token punctuation">;</span>
  //     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  //       this.theme.color <span class="token operator">=</span> this.theme.color <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&quot;blue&quot;</span> ? <span class="token string">&quot;red&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">;</span>
  //     <span class="token punctuation">}</span>
  //   <span class="token punctuation">}</span>
  // <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// F 组件 
<span class="token operator">&lt;</span>template functional<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">&quot;border2&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h3 :style<span class="token operator">=</span><span class="token string">&quot;{ color: injections.theme.color }&quot;</span><span class="token operator">&gt;</span>F 组件<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
  <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  inject: <span class="token punctuation">{</span>
    theme: <span class="token punctuation">{</span>
      //函数式组件取值不一样
      default: <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>虽说<code>provide</code> 和 <code>inject</code> 主要为高阶插件/组件库提供用例，但如果你能在业务中熟练运用，可以达到事半功倍的效果！</p> <h2 id="方法六、-parent-children与-ref"><a href="#方法六、-parent-children与-ref" class="header-anchor">#</a> 方法六、<code>$parent</code> / <code>$children</code>与 <code>ref</code></h2> <ul><li><code>ref</code>：如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例</li> <li><code>$parent</code> / <code>$children</code>：访问父 / 子实例</li></ul> <p>需要注意的是：这两种都是直接得到组件实例，使用后可以直接调用组件的方法或访问数据。我们先来看个用 <code>ref</code>来访问组件的例子：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// component-a 子组件
<span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
  <span class="token function-name function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
      title: <span class="token string">'Vue.js'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  methods: <span class="token punctuation">{</span>
    <span class="token function-name function">sayHello</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window.alert<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// 父组件
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>component-a <span class="token assign-left variable">ref</span><span class="token operator">=</span><span class="token string">&quot;comA&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/component-a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token builtin class-name">export</span> default <span class="token punctuation">{</span>
    <span class="token function-name function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      const comA <span class="token operator">=</span> this.<span class="token variable">$refs</span>.comA<span class="token punctuation">;</span>
      console.log<span class="token punctuation">(</span>comA.title<span class="token punctuation">)</span><span class="token punctuation">;</span>  // Vue.js
      comA.sayHello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  // 弹窗
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>不过，<strong>这两种方法的弊端是，无法在跨级或兄弟间通信</strong>。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// parent.vue
<span class="token operator">&lt;</span>component-a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/component-a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>component-b<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/component-b<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>component-b<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/component-b<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们想在 component-a 中，访问到引用它的页面中（这里就是 parent.vue）的两个 component-b 组件，那这种情况下，就得配置额外的插件或工具了，比如 Vuex 和 Bus 的解决方案。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>常见使用场景可以分为三类：</p> <ul><li>父子通信：
父向子传递数据是通过 props，子向父是通过 events（<code>$emit</code>）；通过父链 / 子链也可以通信（<code>$parent</code> / <code>$children</code>）；ref 也可以访问组件实例；provide / inject API；<code>$attrs/$listeners</code></li> <li>兄弟通信：
Bus；Vuex</li> <li>跨级通信：
Bus；Vuex；provide / inject API、<code>$attrs/$listeners</code></li></ul> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <ul><li><a href="https://link.juejin.im/?target=http%3A%2F%2Fwww.zhufengpeixun.cn%2Fmain%2Fcourse%2Findex.html" target="_blank" rel="noopener noreferrer">珠峰架构课(强烈推荐)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/book/5bc844166fb9a05cd676ebca" target="_blank" rel="noopener noreferrer">Vue.js 组件精讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://link.juejin.im/?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fapi%2F%23inheritAttrs" target="_blank" rel="noopener noreferrer">Vue.js 官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://link.juejin.im/?target=https%3A%2F%2Ftime.geekbang.org%2Fcourse%2Fdetail%2F163-86419" target="_blank" rel="noopener noreferrer">Vue开发实战<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://link.juejin.im/?target=https%3A%2F%2Fwebcache.googleusercontent.com%2Fsearch%3Fq%3Dcache%3AGCLcuCsGrVIJ%3Ahttps%3A%2F%2Fbingzhe.github.io%2F2017%2F08%2F27%2Fvuex%2525E6%252595%2525B0%2525E6%25258D%2525AE%2525E6%25259C%2525AC%2525E5%25259C%2525B0%2525E5%252582%2525A8%2525E5%2525AD%252598%2F%2B%26cd%3D12%26hl%3Dzh-CN%26ct%3Dclnk%26gl%3Dus" target="_blank" rel="noopener noreferrer">Vuex数据本地储存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://link.juejin.im/?target=https%3A%2F%2Ftech.meituan.com%2Fvuex_code_analysis.html" target="_blank" rel="noopener noreferrer">Vuex框架原理与源码分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5c77c4ae518825407505e262" target="_blank" rel="noopener noreferrer">Vue 组件通信方式全面详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><a href="https://juejin.im/post/5cde0b43f265da03867e78d3?utm_source=gold_browser_extension#heading-7" target="_blank" rel="noopener noreferrer">原文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xn213/Vue/VuePractice/Axios.html" class="prev">
        Vue use axios 项目 api 封装
      </a></span> <span class="next"><a href="/xn213/Vue/Component/HowToCodeBestComponents.html">
        如何写好一个 vue 组件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/xn213/assets/js/app.d4906252.js" defer></script><script src="/xn213/assets/js/2.51fac5b8.js" defer></script><script src="/xn213/assets/js/98.417f15c6.js" defer></script>
  </body>
</html>
