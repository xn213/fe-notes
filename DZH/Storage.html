<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端存储技术 | 余生的前端笔记本</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="description" content="记录平凡">
    <link rel="preload" href="/xn213/assets/css/0.styles.ca63e153.css" as="style"><link rel="preload" href="/xn213/assets/js/app.d4906252.js" as="script"><link rel="preload" href="/xn213/assets/js/2.51fac5b8.js" as="script"><link rel="preload" href="/xn213/assets/js/48.a455dd6a.js" as="script"><link rel="prefetch" href="/xn213/assets/js/10.1faf398f.js"><link rel="prefetch" href="/xn213/assets/js/100.7a74ebc8.js"><link rel="prefetch" href="/xn213/assets/js/101.4f40be2a.js"><link rel="prefetch" href="/xn213/assets/js/102.c8d7cea6.js"><link rel="prefetch" href="/xn213/assets/js/103.270122d2.js"><link rel="prefetch" href="/xn213/assets/js/104.d4a4e842.js"><link rel="prefetch" href="/xn213/assets/js/105.3f397b90.js"><link rel="prefetch" href="/xn213/assets/js/106.918e93a8.js"><link rel="prefetch" href="/xn213/assets/js/107.bed93497.js"><link rel="prefetch" href="/xn213/assets/js/108.8560db9a.js"><link rel="prefetch" href="/xn213/assets/js/109.3d45cd73.js"><link rel="prefetch" href="/xn213/assets/js/11.6bf048df.js"><link rel="prefetch" href="/xn213/assets/js/110.1a0c24e2.js"><link rel="prefetch" href="/xn213/assets/js/111.3fecca9a.js"><link rel="prefetch" href="/xn213/assets/js/112.4acafde9.js"><link rel="prefetch" href="/xn213/assets/js/113.0138919a.js"><link rel="prefetch" href="/xn213/assets/js/114.b6f3a7bb.js"><link rel="prefetch" href="/xn213/assets/js/115.03d6018c.js"><link rel="prefetch" href="/xn213/assets/js/116.9da7bcd2.js"><link rel="prefetch" href="/xn213/assets/js/117.b00f571c.js"><link rel="prefetch" href="/xn213/assets/js/118.805693d4.js"><link rel="prefetch" href="/xn213/assets/js/12.1366bf4e.js"><link rel="prefetch" href="/xn213/assets/js/13.8469840d.js"><link rel="prefetch" href="/xn213/assets/js/14.476bf2b4.js"><link rel="prefetch" href="/xn213/assets/js/15.73262e19.js"><link rel="prefetch" href="/xn213/assets/js/16.a84e4240.js"><link rel="prefetch" href="/xn213/assets/js/17.3be54d85.js"><link rel="prefetch" href="/xn213/assets/js/18.500d10d8.js"><link rel="prefetch" href="/xn213/assets/js/19.8474792d.js"><link rel="prefetch" href="/xn213/assets/js/20.c4c313bc.js"><link rel="prefetch" href="/xn213/assets/js/21.b0881497.js"><link rel="prefetch" href="/xn213/assets/js/22.d5268e49.js"><link rel="prefetch" href="/xn213/assets/js/23.58ca6578.js"><link rel="prefetch" href="/xn213/assets/js/24.a3e7d50c.js"><link rel="prefetch" href="/xn213/assets/js/25.16abe053.js"><link rel="prefetch" href="/xn213/assets/js/26.86c0a1e4.js"><link rel="prefetch" href="/xn213/assets/js/27.7030e691.js"><link rel="prefetch" href="/xn213/assets/js/28.deb79169.js"><link rel="prefetch" href="/xn213/assets/js/29.6eaaf04b.js"><link rel="prefetch" href="/xn213/assets/js/3.b7850748.js"><link rel="prefetch" href="/xn213/assets/js/30.2506a5c4.js"><link rel="prefetch" href="/xn213/assets/js/31.26cfc1d9.js"><link rel="prefetch" href="/xn213/assets/js/32.0a4b2fe0.js"><link rel="prefetch" href="/xn213/assets/js/33.36d9b152.js"><link rel="prefetch" href="/xn213/assets/js/34.2b9dc880.js"><link rel="prefetch" href="/xn213/assets/js/35.2567933d.js"><link rel="prefetch" href="/xn213/assets/js/36.23821499.js"><link rel="prefetch" href="/xn213/assets/js/37.46a4d915.js"><link rel="prefetch" href="/xn213/assets/js/38.78a550d5.js"><link rel="prefetch" href="/xn213/assets/js/39.d61eb27d.js"><link rel="prefetch" href="/xn213/assets/js/4.7e99a2d3.js"><link rel="prefetch" href="/xn213/assets/js/40.933a08eb.js"><link rel="prefetch" href="/xn213/assets/js/41.a470035a.js"><link rel="prefetch" href="/xn213/assets/js/42.fc89c186.js"><link rel="prefetch" href="/xn213/assets/js/43.15247d93.js"><link rel="prefetch" href="/xn213/assets/js/44.ab9e5f68.js"><link rel="prefetch" href="/xn213/assets/js/45.d347fb15.js"><link rel="prefetch" href="/xn213/assets/js/46.3dbf0169.js"><link rel="prefetch" href="/xn213/assets/js/47.bc6372ae.js"><link rel="prefetch" href="/xn213/assets/js/49.42512fc4.js"><link rel="prefetch" href="/xn213/assets/js/5.9753c03c.js"><link rel="prefetch" href="/xn213/assets/js/50.d154eba7.js"><link rel="prefetch" href="/xn213/assets/js/51.615c6988.js"><link rel="prefetch" href="/xn213/assets/js/52.826146fc.js"><link rel="prefetch" href="/xn213/assets/js/53.86dca864.js"><link rel="prefetch" href="/xn213/assets/js/54.5537cce4.js"><link rel="prefetch" href="/xn213/assets/js/55.7e134c54.js"><link rel="prefetch" href="/xn213/assets/js/56.84100376.js"><link rel="prefetch" href="/xn213/assets/js/57.6b67fd76.js"><link rel="prefetch" href="/xn213/assets/js/58.9b9f3130.js"><link rel="prefetch" href="/xn213/assets/js/59.f3e68bcf.js"><link rel="prefetch" href="/xn213/assets/js/6.a4f112fa.js"><link rel="prefetch" href="/xn213/assets/js/60.a4243a5c.js"><link rel="prefetch" href="/xn213/assets/js/61.29628b38.js"><link rel="prefetch" href="/xn213/assets/js/62.3f0b67b9.js"><link rel="prefetch" href="/xn213/assets/js/63.910061cb.js"><link rel="prefetch" href="/xn213/assets/js/64.48d637e0.js"><link rel="prefetch" href="/xn213/assets/js/65.a11ce1db.js"><link rel="prefetch" href="/xn213/assets/js/66.c7d82608.js"><link rel="prefetch" href="/xn213/assets/js/67.ee9cd709.js"><link rel="prefetch" href="/xn213/assets/js/68.37ca6255.js"><link rel="prefetch" href="/xn213/assets/js/69.fb07e58e.js"><link rel="prefetch" href="/xn213/assets/js/7.f165d4ad.js"><link rel="prefetch" href="/xn213/assets/js/70.c6515a0e.js"><link rel="prefetch" href="/xn213/assets/js/71.c6d65667.js"><link rel="prefetch" href="/xn213/assets/js/72.edd126d5.js"><link rel="prefetch" href="/xn213/assets/js/73.c8230ab6.js"><link rel="prefetch" href="/xn213/assets/js/74.9169bdfa.js"><link rel="prefetch" href="/xn213/assets/js/75.7f969006.js"><link rel="prefetch" href="/xn213/assets/js/76.7f70450f.js"><link rel="prefetch" href="/xn213/assets/js/77.84b9567f.js"><link rel="prefetch" href="/xn213/assets/js/78.ec259083.js"><link rel="prefetch" href="/xn213/assets/js/79.0f38cf96.js"><link rel="prefetch" href="/xn213/assets/js/8.93badb4c.js"><link rel="prefetch" href="/xn213/assets/js/80.00d59f1a.js"><link rel="prefetch" href="/xn213/assets/js/81.296081e7.js"><link rel="prefetch" href="/xn213/assets/js/82.1a7bb394.js"><link rel="prefetch" href="/xn213/assets/js/83.49934a5f.js"><link rel="prefetch" href="/xn213/assets/js/84.8302d481.js"><link rel="prefetch" href="/xn213/assets/js/85.5b6eca11.js"><link rel="prefetch" href="/xn213/assets/js/86.9cd3ce36.js"><link rel="prefetch" href="/xn213/assets/js/87.909f3fbe.js"><link rel="prefetch" href="/xn213/assets/js/88.97d3b017.js"><link rel="prefetch" href="/xn213/assets/js/89.eb9b8edc.js"><link rel="prefetch" href="/xn213/assets/js/9.48527424.js"><link rel="prefetch" href="/xn213/assets/js/90.81ddc649.js"><link rel="prefetch" href="/xn213/assets/js/91.ea383d56.js"><link rel="prefetch" href="/xn213/assets/js/92.31ffb78c.js"><link rel="prefetch" href="/xn213/assets/js/93.6f5a3c6c.js"><link rel="prefetch" href="/xn213/assets/js/94.3092c543.js"><link rel="prefetch" href="/xn213/assets/js/95.1396fb1e.js"><link rel="prefetch" href="/xn213/assets/js/96.d7c769c9.js"><link rel="prefetch" href="/xn213/assets/js/97.5c6b604b.js"><link rel="prefetch" href="/xn213/assets/js/98.417f15c6.js"><link rel="prefetch" href="/xn213/assets/js/99.c8d339c0.js">
    <link rel="stylesheet" href="/xn213/assets/css/0.styles.ca63e153.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xn213/" class="home-link router-link-active"><!----> <span class="site-name">余生的前端笔记本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xn213/Computer/" class="nav-link">
  计算机
</a></div><div class="nav-item"><a href="/xn213/Frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/xn213/Notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/xn213/Interview/" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/xn213/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/xn213/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/xn213/Vue/VueBasic/VueRespond.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/xn213/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/xn213/CodeTools/VSCode/VSCodeVue.html" class="nav-link">
  CodeTools
</a></div><div class="nav-item"><a href="/xn213/DZH/Explain.html" class="nav-link">
  大杂烩
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xn213/Computer/" class="nav-link">
  计算机
</a></div><div class="nav-item"><a href="/xn213/Frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/xn213/Notes/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/xn213/Interview/" class="nav-link">
  Interview
</a></div><div class="nav-item"><a href="/xn213/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/xn213/CSS/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/xn213/Vue/VueBasic/VueRespond.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/xn213/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/xn213/CodeTools/VSCode/VSCodeVue.html" class="nav-link">
  CodeTools
</a></div><div class="nav-item"><a href="/xn213/DZH/Explain.html" class="nav-link">
  大杂烩
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/xn213/DZH/Explain.html" class="sidebar-link">包罗万象吃遍 web</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>搜刮到的前端技术文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xn213/DZH/Ajax.html" class="sidebar-link">Ajax的全面总结</a></li><li><a href="/xn213/DZH/AjaxTechDetails.html" class="sidebar-link">Ajax技术细节</a></li><li><a href="/xn213/DZH/FrontendTools.html" class="sidebar-link">大前端工具搜集</a></li><li><a href="/xn213/DZH/CookieSession.html" class="sidebar-link">彻底理解cookie, session, token</a></li><li><a href="/xn213/DZH/Storage.html" class="active sidebar-link">前端存储技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#storage" class="sidebar-link">Storage</a></li><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#indexeddb" class="sidebar-link">IndexedDB</a></li><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#后记" class="sidebar-link">后记</a></li><li class="sidebar-sub-header"><a href="/xn213/DZH/Storage.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/xn213/DZH/BigInterview.html" class="sidebar-link">大而全的面试题</a></li><li><a href="/xn213/DZH/GitDetail.html" class="sidebar-link">Git使用教程: 浅显易懂</a></li><li><a href="/xn213/DZH/HeadTags.html" class="sidebar-link">很全的HEAD标签</a></li><li><a href="/xn213/DZH/MobileReg.html" class="sidebar-link">中国大陆手机号码的正则表达式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Growing 成长档案</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端存储技术"><a href="#前端存储技术" class="header-anchor">#</a> 前端存储技术</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>后端常用数据库做数据存储，譬如<code>MySql</code>、<code>MongoDB</code>，缓存技术存储数据，如<code>Redis</code>、<code>Memcached</code>；</p> <p>前端存储数据目前常用的是<code>Cookie</code>、<code>Storage</code>、<code>IndexedDB</code></p> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h2> <p><code>HTTP Cookie</code>（也叫<code>Web Cookie</code>或浏览器<code>Cookie</code>）是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。<code>Cookie</code>使基于无状态的<code>HTTP</code>协议记录稳定的状态信息成为了可能。</p> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <p><code>Cookie</code>总是保存在客户端中（早期<code>Java</code>中经常会将<code>Cookie</code>与<code>Session</code>作为存储技术进行比较，<code>Session</code>是将数据保存在服务器端，大量的数据存储会增加服务器的负担），按在客户端中的存储位置，可分为内存<code>Cookie</code>和硬盘<code>Cookie</code>。
内存<code>Cookie</code>由浏览器维护，保存在内存中，浏览器关闭后就消失了，其存在时间是短暂的。硬盘<code>Cookie</code>保存在硬盘里，有一个过期时间，除非用户手工清理或到了过期时间，硬盘<code>Cookie</code>不会被删除，其存在时间是长期的。所以，按存在时间，可分为非持久<code>Cookie</code>和持久<code>Cookie</code>。</p> <h3 id="创建cookie"><a href="#创建cookie" class="header-anchor">#</a> 创建Cookie</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>Set-Cookie`响应头部和`Cookie`请求头部节
服务器使用`Set-Cookie`响应头部向用户代理（一般是浏览器）发送`Cookie`信息。一个简单的`Cookie`可能像这样：`Set-Cookie: &lt;cookie名&gt;=&lt;cookie值&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>服务器通过该头部告知客户端保存<code>Cookie</code>信息</p> <p>浏览器环境下获取非<code>HttpOnly</code>标记的 <code>cookie</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var cookies = document.cookie;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="cookie的缺点"><a href="#cookie的缺点" class="header-anchor">#</a> Cookie的缺点</h3> <p><code>Cookie</code>会被附加在每个<code>HTTP</code>请求中，所以无形中增加了流量。由于在<code>HTTP</code>请求中的<code>Cookie</code>是明文传递的，所以安全性成问题，除非用<code>HTTPS</code>。</p> <p><code>Cookie</code>的大小限制在<code>4KB</code>左右，对于复杂的存储需求来说是不够用的。</p> <h3 id="cookie的简单封装"><a href="#cookie的简单封装" class="header-anchor">#</a> Cookie的简单封装</h3> <p>设置<code>Cookie</code>时一般会将路径和过期时间一并设置，注意过期时间需要转换成<code>GMT</code>或者<code>UTC</code></p> <p>代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">IIFE</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">cname<span class="token punctuation">,</span> defaultValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'(^|;| )'</span><span class="token operator">+</span>cname<span class="token operator">+</span><span class="token string">'=([^;]*?)(;|$)'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span> defaultValue<span class="token punctuation">;</span>
    <span class="token keyword">return</span> value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token parameter">cname<span class="token punctuation">,</span> cvalue<span class="token punctuation">,</span> day<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    day <span class="token operator">=</span> day <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
    path <span class="token operator">=</span> path <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    date<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> day <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> cname<span class="token operator">+</span><span class="token string">'='</span><span class="token operator">+</span>cvalue<span class="token operator">+</span><span class="token string">'; expires='</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'; path='</span><span class="token operator">+</span>path<span class="token operator">+</span><span class="token string">'; '</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">deleteCookie</span><span class="token punctuation">(</span><span class="token parameter">cname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setCookie</span><span class="token punctuation">(</span>cname<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  root<span class="token punctuation">.</span>Util <span class="token operator">=</span> <span class="token punctuation">{</span>
    getCookie<span class="token operator">:</span> getCookie<span class="token punctuation">,</span>
    setCookie<span class="token operator">:</span> setCookie<span class="token punctuation">,</span>
    deleteCookie<span class="token operator">:</span> deleteCookie<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>测试结果</p> <p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684fbbfe3390d0b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <h2 id="storage"><a href="#storage" class="header-anchor">#</a> Storage</h2> <p>作为 <code>Web Storage API</code>的接口，<code>Storage</code> 提供了访问特定域名下的会话存储（<code>session storage</code>）或本地存储（<code>local storage</code>）的功能，例如，可以添加、修改或删除存储的数据项。</p> <p>如果你想要操作一个域名的会话存储（<code>session storage</code>），可以使用 <code>window.sessionStorage</code>如果想要操作一个域名的本地存储（<code>local storage</code>），可以使用  <code>window.localStorage</code>。</p> <p><code>sessionStorage</code>和<code>localStorage</code>的用法是一样的，区别在于<code>sessionStorage</code>会在会话关闭也就是浏览器关闭时失效，而<code>localStorage</code>是将数据存储在本地，不受关闭浏览器影响，除非手动清除数据</p> <p>相关的api大家可以参考</p> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FlocalStorage" target="_blank" rel="noopener noreferrer">developer.mozilla.org/zh-CN/docs/…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">IIFE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'your browser is not support localStorage!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token parameter">sname<span class="token punctuation">,</span> defaultValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//result = window.localStorage.sname</span>
    <span class="token comment">//result = window.localStorage[sname]</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>sname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result <span class="token operator">||</span> defaultValue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token parameter">sname<span class="token punctuation">,</span> svalue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> svalue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token parameter">sname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>sname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token parameter">keyIndex</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>keyIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">getAllKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">clearStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">onStorageChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> onStorageChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>Util <span class="token operator">=</span> <span class="token punctuation">{</span>
    getStorage<span class="token operator">:</span> getStorage<span class="token punctuation">,</span>
    setStorage<span class="token operator">:</span> setStorage<span class="token punctuation">,</span>
    removeItem<span class="token operator">:</span> removeItem<span class="token punctuation">,</span>
    getKey<span class="token operator">:</span> getKey<span class="token punctuation">,</span>
    getAllKeys<span class="token operator">:</span> getAllKeys<span class="token punctuation">,</span>
    clearStorage<span class="token operator">:</span> clearStorage<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>测试结果</p> <p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684fbf0318cda64?imageslim" alt="img"></p> <h2 id="indexeddb"><a href="#indexeddb" class="header-anchor">#</a> IndexedDB</h2> <p>随着浏览器的功能不断增强，越来越多的网站开始考虑，将大量数据储存在客户端，这样可以减少从服务器获取数据，直接从本地获取数据。</p> <p>现有的浏览器数据储存方案，都不适合储存大量数据：<code>Cookie</code>的大小不超过 <code>4KB</code>，且每次请求都会发送回服务器；<code>LocalStorage</code>在 <code>2.5MB</code> 到 <code>10MB</code> 之间（各家浏览器不同），而且不提供搜索功能，不能建立自定义的索引。所以，需要一种新的解决方案，这就是 <code>IndexedDB</code> 诞生的背景。</p> <p>通俗地说，<code>IndexedDB</code>就是浏览器提供的本地数据库，它可以被网页脚本创建和操作。<code>IndexedDB</code>允许储存大量数据，提供查找接口，还能建立索引。这些都是<code>LocalStorage</code> 所不具备的。就数据库类型而言，<code>IndexedDB</code>不属于关系型数据库（不支持 <code>SQL</code>查询语句），更接近 <code>NoSQL</code>数据库。</p> <p><code>IndexedDB</code>相关<code>API</code>可参考</p> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwangdoc.com%2Fjavascript%2Fbom%2Findexeddb.html%23indexeddb-%25E5%25AF%25B9%25E8%25B1%25A1" target="_blank" rel="noopener noreferrer">wangdoc.com/javascript/…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">IIFE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'your browser is not support indexedDB!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> db<span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库打开报错'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库打开成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onupgradeneeded...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'id'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token comment">//.add({ id: 1, name: 'ccy', age: 18, email: 'test@example.com' });</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据写入失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'事务失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'未获得数据记录'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    objectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Id: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有更多数据了！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token comment">//.put({ id: 1, name: '李四', age: 35, email: 'lisi@example.com' });</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据更新成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据更新失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span>util <span class="token operator">=</span> <span class="token punctuation">{</span>
    add<span class="token operator">:</span> add<span class="token punctuation">,</span>
    read<span class="token operator">:</span> read<span class="token punctuation">,</span>
    readAll<span class="token operator">:</span> readAll<span class="token punctuation">,</span>
    update<span class="token operator">:</span> update<span class="token punctuation">,</span>
    remove<span class="token operator">:</span> remove<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><p>测试结果</p> <p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684fc0dd85b9d08?imageslim" alt="img"></p> <h2 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h2> <p>浏览器存储技术目前流行的基本就上面介绍的三种，之前出现的<code>webSql</code>由于用方言<code>SQLlite</code>导致无法统一，也就是说这是一个废弃的标准。</p> <p><code>localStorage</code>、<code>indexedDB</code>这里没有做详细的介绍，只是简单的给出示例代码做做演示，不熟悉的可以查阅相关<code>API</code>。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FStorage" target="_blank" rel="noopener noreferrer">developer.mozilla.org/zh-CN/docs/…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCookies" target="_blank" rel="noopener noreferrer">developer.mozilla.org/zh-CN/docs/…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2FCookie" target="_blank" rel="noopener noreferrer">zh.wikipedia.org/wiki/Cookie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://link.juejin.im/?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2018%2F07%2Findexeddb.html" target="_blank" rel="noopener noreferrer">www.ruanyifeng.com/blog/2018/0…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwangdoc.com%2Fjavascript%2Fbom%2Findexeddb.html" target="_blank" rel="noopener noreferrer">wangdoc.com/javascript/…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>作者：蟹丸</p> <p>链接：https://juejin.im/post/5c3d5d97e51d455243765e8a</p> <p>来源：掘金</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xn213/DZH/CookieSession.html" class="prev">
        彻底理解cookie, session, token
      </a></span> <span class="next"><a href="/xn213/DZH/BigInterview.html">
        大而全的面试题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/xn213/assets/js/app.d4906252.js" defer></script><script src="/xn213/assets/js/2.51fac5b8.js" defer></script><script src="/xn213/assets/js/48.a455dd6a.js" defer></script>
  </body>
</html>
